<!DOCTYPE html><html lang="zh-CN"><head> <meta name="author" content="励小加"> <meta name="copyright" content="© 2025 励小加"><meta name="license" content="GPL-3.0"> <meta name="generator" content="正反馈成长助手"> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>正反馈成长助手</title> <style> :root { --primary: #4CAF50; --secondary: #2196F3; --accent: #FF9800; --light: #f5f5f5; --dark: #333; --danger: #f4634b; --success: #4CAF50; --collapse: #74b9ff; } * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; } body { background-color: #f0f2f5; color: var(--dark); line-height: 1.6; font-size: 16px; } .container { max-width: 800px; margin: 0 auto; padding: 15px; } .header-controls { display: none; transition: all 0.3s ease; } .header-controls.visible { display: block; } .btn-export { background-color: #2196F3; } .btn-import { background-color: #2196F3; } .btn-reminder { background-color: #FF9800; } .btn-reset { background-color: #f44336; } .import-categories { font-size: 0.8rem; line-height: 1.2; } .import-category-section { margin-bottom: 0; } .import-category-section label { margin-bottom: 0; } #import-achievements-details, #import-skills-details, #import-reflections-details, #import-value-details { font-size: 0.8rem; line-height: 1; } .import-category-section label span { font-size: 0.75rem; } .export-options { margin: 8px 0; } .export-options h4 { margin-bottom: 4px; font-size: 0.9rem; } .date-range-inputs { gap: 3px; margin-bottom: 6px; display: flex; } .export-categories { gap: 3px; margin: 3px 0; } .export-preview { margin-top: 5px; } .export-preview h4 { margin-bottom: 3px; } header { text-align: center; margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s ease; cursor: pointer; } header.reminder { background: linear-gradient(135deg, #f44336, #FF9800); } header h1 { font-size: 1.5rem; } header p { font-size: 0.9rem; } .nav-tabs { display: flex; justify-content: space-around; margin-bottom: 15px; background: white; border-radius: 10px; padding: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); flex-wrap: wrap; } .tab { padding: 8px 12px; cursor: pointer; border-radius: 5px; transition: all 0.3s ease; margin: 2px; text-align: center; flex: 1; min-width: 0; background-color: white; color: var(--dark); } .tab.active { background-color: var(--primary); color: white; } .tab-content { display: none; background: white; padding: 15px; border-radius: 10px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); } .tab-content.active { display: block; } .achievement-item, .skill-item, .value-item, .reflection-item { background: var(--light); padding: 12px; margin: 5px 0; border-radius: 8px; border-left: 4px solid var(--primary); } .achievement-date { font-weight: bold; margin-top: 4px; color: var(--dark); display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-radius: 5px; }.achievement-date span { display: inline-block; white-space: nowrap;}.achievement-date span .highlight { display: inline;} .collapse-icon { font-size: 1.2rem; transition: transform 0.3s; } .collapsed .collapse-icon { transform: rotate(-90deg); } .collapsible-content { overflow: hidden; transition: max-height 0.3s ease; } .collapsed .collapsible-content { max-height: 0; } .achievement-list { margin-left: 8px; margin-top: 2px; } .achievement-entry { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #e0e0e0; gap: 8px; padding: 3px 0; } .achievement-entry:last-child { border-bottom: none; } .achievement-text { flex-grow: 1; margin-right: 8px; word-break: break-word; line-height: 1.4; font-size: 0.9rem; } .reflection-text, .checkin-text, .value-text { white-space: pre-wrap; } .achievement-time { font-style: italic; color: #888; font-size: 0.8rem; margin-left: 5px; } .modification-history { font-size: 0.7rem; color: #666; margin-top: 8px; padding-left: 8px; border-left: 2px solid #ddd; line-height: 1.3; } .input-group { margin-bottom: 12px; display: flex; gap: 8px; } input, textarea, select { flex: 1; padding: 10px; margin: 4px 0; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; } textarea { resize: vertical; min-height: 80px; } button { background-color: var(--primary); color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; white-space: nowrap; font-size: 14px; } .btn-danger, .btn-edit { margin-top: 5px; margin-bottom: 10px; } .btn-danger { background-color: var(--danger); } .btn-edit { background-color: #d689f4; } .btn-collapse { background-color: var(--collapse); margin-top: 3px; } #reset-modal .action-buttons button { margin-bottom: 0; padding: 10px 15px; font-size: 14px; } .progress-bar { height: 18px; background-color: #e0e0e0; border-radius: 10px; margin: 2px 0; overflow: hidden; margin-top: 3px; } .progress { height: 100%; background-color: var(--primary); border-radius: 10px; transition: width 0.5s ease; } .stats { display: flex; justify-content: space-around; text-align: center; margin: 15px 0; } .stat-item { flex: 1; padding: 8px; } .stat-value { font-size: 24px; font-weight: bold; color: var(--primary); } .stat-item div:last-child { font-size: 0.85rem; } .empty-state { text-align: center; padding: 15px; color: #777; font-size: 0.9rem; } .skill-controls { display: flex; gap: 5px; margin-top: 8px; flex-wrap: wrap; } .skill-controls button { padding: 6px 10px; font-size: 13px; } .skill-category-label { cursor: pointer; transition: all 0.2s ease; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; margin-left: 8px; display: inline-block; } .skill-category-label:hover { transform: scale(1.05); box-shadow: 0 2px 4px rgba(0,0,0,0.2); } .achievement-controls { display: flex; gap: 5px; flex-shrink: 0; align-items: flex-start; } .achievement-controls button { padding: 5px 8px; font-size: 12px; } .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1001; justify-content: center; align-items: center; padding: 15px; } .modal-content { background-color: white; padding: 15px; border-radius: 10px; width: 100%; max-width: 500px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); max-height: 90vh; overflow-y: auto; } .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; } .modal-close { background: none; border: none; font-size: 20px; cursor: pointer; color: #777; } .modal-content textarea, .modal-content input { width: 100%; box-sizing: border-box; } .utility-buttons { display: flex; justify-content: center; gap: 8px; margin: 15px 0; flex-wrap: wrap; } .utility-buttons button { padding: 8px 12px; font-size: 0.85rem; } .checkin-content { margin-top: 8px; } .action-buttons { display: flex; gap: 8px; justify-content: flex-end; margin-top: 12px; } .streak-milestone { color: var(--accent); font-weight: bold; margin-top: 4px; font-size: 0.8rem; } .value-category { background: white; padding: 12px; margin: 8px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); } .value-category h3 { margin-bottom: 8px; color: var(--primary); font-size: 1.1rem; } .value-category p { margin-bottom: 12px; color: #555; font-size: 0.9rem; } .skill-header, .value-output-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 3px; cursor: pointer; padding: 8px; border-radius: 5px; transition: background-color 0.3s; } .skill-header h3, .value-output-header h3 { margin: 0; flex-grow: 1; font-size: 1.1rem; } .skill-header-controls, .value-output-header-controls { display: flex; gap: 2px; } .skill-header-controls button, .value-output-header-controls button { padding: 3px 8px; font-size: 12px; } .value-output-item { background: var(--light); padding: 12px; margin: 5px 0; border-radius: 8px; border-left: 4px solid var(--primary); } .value-output-header { margin-bottom: 8px; } .value-category-buttons { display: flex; flex-wrap: nowrap; gap: 2px; margin: 5px 0; } .value-category-button { flex: 1; min-width: 0px; background-color: white; color: var(--dark); padding: 10px 4px; text-align: center; border-radius: 8px; cursor: pointer; border: 1px solid #ddd; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; transition: all 0.3s ease; } .value-category-button.active { background-color: var(--primary); color: white; flex: 2; min-width: 80px; } @media (min-width: 601px) { .value-category-button.active { flex: 1; } } .value-input-area { display: none; background: white; padding: 12px; margin: 8px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); } .value-input-area.active { display: block; } .search-container { margin: 15px 0; display: flex; gap: 8px; align-items: center; } .search-input-wrapper { position: relative; flex: 1; min-width: 200px; } .search-container input { width: 100%; padding-right: 35px; } .search-clear { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; font-size: 18px; cursor: pointer; color: #999; display: flex; align-items: center; justify-content: center; width: 20px; height: 20px; border-radius: 50%; } .search-clear:hover { background-color: #f0f0f0; color: #666; } .collapse-controls { display: flex; justify-content: flex-end; margin-bottom: 10px; gap: 8px; } .highlight { background-color: #ffeb3b; border-radius: 2px; } .calendar-button { background-color: var(--accent); } .date-filter-tabs { display: flex; margin-bottom: 15px; border-bottom: 1px solid #ddd; } .date-filter-tab { padding: 8px 15px; cursor: pointer; border-bottom: 2px solid transparent; } .date-filter-tab.active { border-bottom: 2px solid var(--primary); color: var(--primary); } .date-filter-content { display: none; padding: 10px 0; } .date-filter-content.active { display: block; } .calendar-container { max-height: 300px; overflow-y: auto; margin-top: 10px; } .calendar-month { margin-bottom: 15px; } .calendar-month-header { text-align: center; padding: 5px; background-color: var(--light); border-radius: 5px; margin-bottom: 5px; font-weight: bold; } .calendar-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-weight: bold; margin-bottom: 5px; } .calendar-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; } .calendar-day { text-align: center; padding: 5px; border-radius: 3px; cursor: pointer; } .calendar-day.recorded { background-color: var(--primary); color: white; } .calendar-day.selected { background-color: var(--accent); color: white; } .calendar-day:hover { background-color: #e0e0e0; } .calendar-day.empty { background-color: transparent; cursor: default; } .export-options { margin: 15px 0; } .export-options h4 { margin-bottom: 8px; color: var(--dark); } .export-categories { display: flex; flex-direction: column; gap: 8px; margin: 10px 0; } .export-category-label { display: flex; align-items: center; gap: 8px; cursor: pointer; } .export-preview { margin-top: 15px; } .export-preview textarea { width: 100%; min-height: 150px; margin-top: 8px; } .import-results { max-height: 200px; overflow-y: auto; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; padding: 10px; background-color: var(--light); } .import-result-item { padding: 5px 0; border-bottom: 1px solid #e0e0e0; } .import-result-item:last-child { border-bottom: none; } .import-success { color: var(--success); } .import-failure { color: var(--danger); } .password-input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; } .password-error { color: var(--danger); font-size: 0.9rem; margin-top: 5px; display: none; } .skill-category-buttons { display: flex; flex-wrap: wrap; gap: 8px; margin: 15px 0; } .skill-category-button { flex: 1; min-width: 120px; background-color: white; color: var(--dark); padding: 10px 12px; text-align: center; border-radius: 8px; cursor: pointer; border: 1px solid #ddd; } .skill-category-button.active { background-color: var(--primary); color: white; } .skill-category-selector { display: flex; gap: 5px; margin-top: 8px; } .skill-category-selector select { flex: 1; padding: 6px 8px; font-size: 14px; } .skill-category-completed { border-left: 4px solid var(--success); } .skill-category-focus { border-left: 4px solid var(--accent); } .skill-category-want { border-left: 4px solid var(--secondary); } .category-completed { background-color: var(--success); color: white; } .category-focus { background-color: var(--accent); color: white; } .category-want { background-color: var(--secondary); color: white; } .reflection-title { font-weight: bold; margin-top: 10px; color: var(--primary); font-size: 1rem; } .skill-action-modal { text-align: center; } .skill-action-buttons { display: flex; flex-direction: column; gap: 10px; margin: 20px 0; } .skill-action-buttons button { padding: 12px; font-size: 16px; } .existing-skills-list { max-height: 200px; overflow-y: auto; margin: 15px 0; border: 1px solid #ddd; border-radius: 5px; } .existing-skill-item { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; transition: background-color 0.2s; } .existing-skill-item:hover { background-color: #f5f5f5; } .existing-skill-item:last-child { border-bottom: none; } .reflection-content { max-height: 200px; overflow-y: auto; border-bottom: 1px solid #e0e0e0; border-radius: 5px; } .value-output-content { max-height: 200px; overflow-y: auto; border-bottom: 1px solid #e0e0e0; } .reminder-options { margin: 15px 0; } .reminder-options h4 { margin-bottom: 8px; color: var(--dark); } .reminder-type { display: flex; gap: 15px; margin-bottom: 15px; } .reminder-type label { display: flex; align-items: center; gap: 5px; cursor: pointer; } .reminder-details { margin-top: 10px; } .reminder-details select { margin: 5px 0; width: 100%; } .reflection-meta { margin-top: 10px; padding: 5px; } .value-output-entry { margin-bottom: 3px; }.value-output-meta .modification-history { background: #f5f5f5; border-radius: 4px; font-size: 0.8rem;} label { display: flex; align-items: center; justify-content: space-between; cursor: pointer; } .preview-format-btn { padding: 6px 12px; border: 1px solid #ddd; background: white; color: #333; border-radius: 4px; cursor: pointer; transition: all 0.3s ease; } .preview-format-btn.active { background-color: var(--primary); color: white; border-color: var(--primary); } .preview-format-btn:hover:not(.active) { background-color: #f5f5f5; } @media (min-width: 601px) and (max-width: 1024px) { .container { padding: 20px; } .tab { padding: 10px 15px; } } @media (max-width: 600px) { .tab-content h2 { font-size: 1.2rem; line-height: 1.2; margin-bottom: 5px; } .tab-content > p { font-size: 0.95rem; line-height: 1.2; margin-bottom: 5px; } .value-input-area h3 { font-size: 1.1rem; line-height: 1.3; } .value-input-area > p { font-size: 0.9rem; line-height: 1.2; margin-bottom: 3px; } .date-range-inputs { flex-direction: row !important; flex-wrap: nowrap !important; gap: 5px; align-items: center; } .date-range-inputs input { flex: 1; min-width: 0; font-size: 14px; } .date-range-inputs span { white-space: nowrap; flex-shrink: 0; } .export-options .date-range-inputs { display: flex; flex-direction: row; align-items: center; } .container { padding: 10px; } header { padding: 12px; margin-bottom: 15px; } header h1 { font-size: 1.3rem; } .nav-tabs { flex-direction: row; padding: 5px; justify-content: space-between; gap: 0; } .tab { flex: 1; min-width: 0; padding: 8px 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 0.85rem; margin: 0; } .input-group { flex-direction: column; } .skill-controls { flex-wrap: wrap; } .achievement-entry { flex-direction: column; align-items: flex-start; } .achievement-text { margin-right: 0; margin-bottom: 5px; } .achievement-controls { width: 100%; justify-content: flex-end; } .utility-buttons { flex-direction: row; justify-content: center; } .utility-buttons button { min-width: auto; font-size: 0.9rem; padding: 8px 10px; margin: 2px; } .action-buttons { flex-direction: row; } .action-buttons button { width: auto; } .skill-header, .value-output-header { flex-direction: column; align-items: flex-start; } .skill-header-controls, .value-output-header-controls { margin-top: 8px; width: 100%; justify-content: flex-end; } .value-category-buttons { flex-wrap: nowrap; gap: 1px; } .value-category-button { padding: 8px 2px; font-size: 0.85rem; min-width: 60px; } .value-category-button.active { flex: 3; min-width: 100px; } .stats { margin: 10px 0; } .stat-value { font-size: 18px; } .stat-item div:last-child { font-size: 0.8rem; } .modal-content { padding: 12px; } textarea { min-height: 60px; } .date-range-inputs { flex-direction: column; } .date-filter-tabs { flex-wrap: wrap; } .date-filter-tab { padding: 6px 10px; font-size: 0.85rem; } .skill-category-buttons { flex-direction: row; gap: 0; } .skill-category-button { flex: 1; min-width: 0; padding: 10px 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 0.85rem; margin: 1px; } .search-input-wrapper { min-width: 150px; } .reflection-content, .value-output-content { max-height: 150px; } } @media (max-width: 380px) { h2 { font-size: 1.2rem; } .tab { font-size: 0.8rem; padding: 7px 4px; } .utility-buttons button { font-size: 0.85rem; padding: 7px 8px; } .value-category-button { font-size: 0.75rem; padding: 8px 4px; } .skill-category-button { font-size: 0.75rem; padding: 8px 4px; } .search-input-wrapper { min-width: 120px; } }@media (max-width: 600px) { .reflection-buttons-container { flex-direction: row;display: flex; width: 100%;gap: 2px; } .reflection-buttons-container button { flex: 1; }}#privacy-modal .modal-content { border: 2px solid #4CAF50; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);max-width: 450px; padding: 15px;} </style> </head><body><div id="privacy-modal" class="modal" style="display: none;"> <div class="modal-content"> <div class="modal-header"> <h3>重要声明与使用须知</h3> </div> <div style="max-height: 400px; overflow-y: auto; line-height: 1.6;"> <h4 style="margin-top: 0px;">⚠️ 免责声明</h4> <p>1. 本工具为<strong>免费的个人成长辅助工具</strong>，不提供任何形式的担保</p> <p>2. <strong>不适合人群</strong>：容易产生强迫行为和有严重心理问题者</p> <p>3. 开发者<strong>不对任何直接或间接损失负责</strong></p> <h4>🔒 数据安全</h4> <p>• 所有数据<strong>仅存储在浏览器本地</strong>，不会上传到任何服务器</p> <p>• 请务必<strong>定期使用导出功能备份数据</strong>，防止意外丢失</p> <p>• 清除浏览器或设备数据会导致<strong>所有记录永久丢失</strong></p> <h4>❤️ 健康使用建议</h4> <p>• 每天记录3-5件小事即可，<strong>不要强求完美记录</strong></p> <p>• 关注进步而非不足，<strong>庆祝每一个小成就</strong></p> <p>• 如果记录让你感到压力，<strong>立即减少频率或暂停使用</strong></p> <p>• 本工具<strong>不能替代专业心理咨询或治疗</strong></p> </div> <div class="action-buttons"> <button onclick="acceptPrivacy()" style="background-color: #4CAF50;">我理解并同意以上条款</button> </div> </div></div> <div class="container"> <header id="main-header" onclick="toggleHeaderControls()" style="cursor: pointer;"> <h1>正反馈成长助手</h1> <div class="slogan-container"> <p id="random-slogan" class="slogan-item"></p> </div> </header> <div class="header-controls"> <div class="utility-buttons"> <button class="btn-export" onclick="showEnhancedExportModal()">导出</button> <button class="btn-import" onclick="showEnhancedImportModal()">导入</button> <button class="btn-reminder" onclick="showReminderModal()">提醒</button> <button class="btn-reset" onclick="resetData()">重置</button> <button class="btn-privacy" onclick="showPrivacyModal()">声明</button> </div> <div class="search-container"> <div class="search-input-wrapper"> <input type="text" id="search-input" placeholder="搜索所有内容..." onkeypress="handleSearchKeypress(event)"> <button class="search-clear" id="search-clear" title="清除搜索">×</button> </div> <button onclick="performSearch()">搜索</button> <button class="calendar-button" onclick="showDateFilterModal()">📅</button> </div> <div id="search-status" style="display: none; margin-bottom: 10px; padding: 8px; background: #e0f7fa; border-radius: 4px; font-size: 0.9rem;"> <span id="search-status-text"></span> <button onclick="clearSearch()" style="margin-left: 10px; padding: 2px 8px; background: #00796b; color: white; border: none; border-radius: 3px; cursor: pointer;">清除搜索</button> </div> </div> <div class="stats"> <div class="stat-item"> <div class="stat-value" id="achievement-count">0</div> <div>成就时刻</div> <div class="streak-milestone"></div> </div> <div class="stat-item"> <div class="stat-value" id="skill-count">0</div> <div>能力发展</div> <div class="streak-milestone"></div> </div> <div class="stat-item"> <div class="stat-value" id="record-days">0</div> <div>记录天数</div> <div class="streak-milestone" id="record-milestone"></div> </div> </div> <div class="nav-tabs"> <div class="tab active" data-tab="achievements">每日成就</div> <div class="tab" data-tab="skills">技能成长</div> <div class="tab" data-tab="reflection">自我对话</div> <div class="tab" data-tab="value">创造价值</div> </div> <div id="achievements" class="tab-content active"> <h2>每日微成就和小确幸</h2> <p>培养自我认可，从记录今天完成的3件小事开始。及时记录美好，增加生活幸福感~</p> <div class="input-group"> <input type="text" id="new-achievement" placeholder="今天让我感到充实，幸运或有成就感的事情..."> <button onclick="addAchievement()">添加成就</button> </div> <div class="collapse-controls"> <button class="btn-collapse" onclick="toggleAllCollapsible('achievements')">全部折叠/展开</button> </div> <div id="achievements-list"> </div> </div> <div id="skills" class="tab-content"> <h2>技能成长地图</h2> <p>每一次练习都在绘制你的能力版图。持续记录，清晰看到自己的进步轨迹</p> <div class="input-group"> <textarea id="new-skill" placeholder="你想培养什么能力？或记录当前的练习进展" rows="1"></textarea> <button onclick="showSkillActionModal()">添加技能/打卡</button> </div> <div class="skill-category-buttons"> <button class="skill-category-button active" data-category="all">全部</button> <button class="skill-category-button" data-category="want">想学</button> <button class="skill-category-button" data-category="focus">近期重点</button> <button class="skill-category-button" data-category="completed">已完成</button> </div> <div class="collapse-controls"> <button class="btn-collapse" onclick="toggleAllCollapsible('skills')">全部折叠/展开</button> </div> <div id="skills-list"> </div> </div> <div id="reflection" class="tab-content"> <h2>内在对话觉察</h2> <p>关注你对自己的评价方式。完成一件事时，试着问：'这次经历中，我欣赏自己的哪些表现？''我获得了什么新的理解？"</p><div class="input-group"> <textarea id="reflection-text" placeholder="（默认第一行为标题）&#10;我做得好的部分是什么？我从这个过程学到了什么？..." rows="4"></textarea></div><div class="reflection-buttons-container"> <button ondblclick="insertDiaryTemplate()" style="background-color: #ff9800;">日记模板</button> <button onclick="saveReflection()">保存反思</button></div> <div class="collapse-controls"> <button class="btn-collapse" onclick="toggleAllCollapsible('reflection')">全部折叠/展开</button> </div> <div id="reflection-list"> </div> </div> <div id="value" class="tab-content"> <h2>创造价值输出的循环</h2> <p>当你将注意力从"获取反馈"转向"创造价值"时，正反馈会自然涌现</p> <div class="value-category-buttons"> <button class="value-category-button active" data-category="share">知识分享</button> <button class="value-category-button" data-category="project">完成小项目</button> <button class="value-category-button" data-category="help">提供无偿帮助</button> <button class="value-category-button" data-category="partnership">外部支持与反馈</button> </div> <div id="value-input-share" class="value-input-area active"> <h3>知识分享</h3> <p>在社交媒体或个人网站上分享你的专业知识或学习心得，既能巩固学习成果又能传播与交流</p> <div class="input-group"> <textarea id="new-share" placeholder="我今天分享了..." rows="3"></textarea> <button onclick="addValueOutput('share')">记录分享</button> </div> </div> <div id="value-input-project" class="value-input-area"> <h3>完成小项目</h3> <p>设定一些能够短期内完成并有明确产出的小项目，体验完整的成就循环</p> <div class="input-group"> <textarea id="new-project" placeholder="我完成的项目是..." rows="3"></textarea> <button onclick="addValueOutput('project')">记录项目</button> </div> </div> <div id="value-input-help" class="value-input-area"> <h3>提供无偿帮助</h3> <p>在你能胜任的领域主动帮助他人，过程中获得的感谢与认可是最真实的</p> <div class="input-group"> <textarea id="new-help" placeholder="我帮助了..." rows="3"></textarea> <button onclick="addValueOutput('help')">记录帮助</button> </div> </div> <div id="value-input-partnership" class="value-input-area"> <h3>外部支持与反馈</h3> <p>记录任何为你带来成长动力的外部支持 - 无论是加入社群、建立伙伴关系，还是获得他人的认可和鼓励</p> <div class="input-group"> <textarea id="new-partnership" placeholder="例如：加入了XX学习社群，与朋友定期交流进展，收到了同事的积极反馈，在论坛上获得了认可..." rows="3"></textarea> <button onclick="addValueOutput('partnership')">记录支持</button> </div> </div> <div class="collapse-controls"> <button class="btn-collapse" onclick="toggleAllCollapsible('value')">全部折叠/展开</button> </div> <div id="value-outputs-list"> </div> </div> </div> <div id="checkin-modal" class="modal"> <div class="modal-content"> <div class="modal-header"> <h3 id="checkin-skill-name">技能打卡</h3> <button class="modal-close" onclick="closeModal('checkin-modal')">&times;</button> </div> <p>记录你今天的进步或成果：</p> <textarea id="checkin-content" rows="4" placeholder="我今天在这个技能上取得了什么进步..."></textarea> <div class="action-buttons"> <button onclick="closeModal('checkin-modal')">取消</button> <button onclick="submitCheckin()">提交打卡</button> </div> </div> </div> <div id="skill-action-modal" class="modal"> <div class="modal-content"> <div class="modal-header"> <h3>添加技能/打卡</h3> <button class="modal-close" onclick="closeModal('skill-action-modal')">&times;</button> </div> <p>选择要操作的技能：</p> <select id="skill-action-select" style="width: 100%; margin: 10px 0;"> <option value="new">新技能</option> </select> <div class="action-buttons"> <button onclick="closeModal('skill-action-modal')">取消</button> <button onclick="processSkillAction()">确定</button> </div> </div> </div> <div id="edit-achievement-modal" class="modal"> <div class="modal-content"> <div class="modal-header"> <h3>修改成就</h3> <button class="modal-close" onclick="closeModal('edit-achievement-modal')">&times;</button> </div> <p>修改成就内容：</p> <textarea id="edit-achievement-content" rows="4" placeholder="请输入新的成就内容..."></textarea> <div class="action-buttons"> <button onclick="closeEditModal('achievement')">取消</button> <button onclick="saveEditModal()">保存修改</button> </div> </div> </div> <div id="edit-reflection-modal" class="modal"> <div class="modal-content"> <div class="modal-header"> <h3>修改反思</h3> <button class="modal-close" onclick="closeModal('edit-reflection-modal')">&times;</button> </div> <p>修改反思内容：</p> <textarea id="edit-reflection-content" rows="4" placeholder="请输入新的反思内容..."></textarea> <div class="action-buttons"> <button onclick="closeEditModal('reflection')">取消</button> <button onclick="saveEditModal()">保存修改</button> </div> </div> </div> <div id="edit-checkin-modal" class="modal"> <div class="modal-content"> <div class="modal-header"> <h3>修改打卡记录</h3> <button class="modal-close" onclick="closeModal('edit-checkin-modal')">&times;</button> </div> <p>修改打卡内容：</p> <textarea id="edit-checkin-content" rows="4" placeholder="请输入新的打卡内容..."></textarea> <div class="action-buttons"> <button onclick="closeEditModal('checkin')">取消</button> <button onclick="saveEditModal()">保存修改</button> </div> </div> </div> <div id="edit-skill-modal" class="modal"> <div class="modal-content"> <div class="modal-header"> <h3>修改技能名称</h3> <button class="modal-close" onclick="closeModal('edit-skill-modal')">&times;</button> </div> <p>修改技能名称：</p> <input type="text" id="edit-skill-name" placeholder="请输入新的技能名称..."> <div class="action-buttons"> <button onclick="closeEditModal('skill')">取消</button> <button onclick="saveEditModal()">保存修改</button> </div> </div> </div> <div id="edit-value-modal" class="modal"> <div class="modal-content"> <div class="modal-header"> <h3>修改价值输出</h3> <button class="modal-close" onclick="closeModal('edit-value-modal')">&times;</button> </div> <p>修改价值输出内容：</p> <textarea id="edit-value-content" rows="4" placeholder="请输入新的内容..."></textarea> <div class="action-buttons"> <button onclick="closeEditModal('value')">取消</button> <button onclick="saveEditModal()">保存修改</button> </div> </div> </div> <div id="enhanced-export-modal" class="modal"> <div class="modal-content"> <div class="modal-header"> <h3>导出数据 - 高级选项</h3> <button class="modal-close" onclick="closeModal('enhanced-export-modal')">&times;</button> </div> <div class="export-options"> <h4>日期范围</h4> <div class="date-range-inputs"> <input type="date" id="export-start-date"> <span>至</span> <input type="date" id="export-end-date"> </div> <h4>选择分类</h4> <div class="export-categories"> <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1px;"> <label class="export-category-label" style="display: flex; align-items: center; gap: 2px; padding: 2px 0;"> <span style="font-size: 0.85rem;">每日成就</span><input type="checkbox" id="export-achievements" class="export-category-checkbox" checked style="margin: 0;"> </label> <label class="export-category-label" style="display: flex; align-items: center; gap: 2px; padding: 2px 0;"> <span style="font-size: 0.85rem;">技能成长</span><input type="checkbox" id="export-skills" class="export-category-checkbox" checked style="margin: 0;"> </label> <label class="export-category-label" style="display: flex; align-items: center; gap: 2px; padding: 2px 0;"> <span style="font-size: 0.85rem;">自我对话</span><input type="checkbox" id="export-reflections" class="export-category-checkbox" checked style="margin: 0;"> </label> <label class="export-category-label" style="display: flex; align-items: center; gap: 2px; padding: 2px 0;"> <span style="font-size: 0.85rem;">创造价值</span><input type="checkbox" id="export-value" class="export-category-checkbox" checked style="margin: 0;"> </label> </div> </div> <div class="export-preview"> <h4>数据预览</h4> <div style="margin-bottom: 10px; display: flex; gap: 5px;"> <button id="preview-json-btn" class="preview-format-btn active" onclick="switchPreviewFormat('json')">源数据</button> <button id="preview-md-btn" class="preview-format-btn" onclick="switchPreviewFormat('md')">MD格式</button> </div> <textarea id="enhanced-export-data" rows="5" readonly></textarea> <div style="margin-top: 10px;"> <h4>导出文件名</h4> <div style="display: flex; gap: 5px; align-items: center;"> <input type="text" id="export-filename-display" readonly style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #f9f9f9;"> <button onclick="copyExportFilename()" style="padding: 8px 12px; white-space: nowrap;">复制文件名</button> </div> </div> </div> </div> <div class="action-buttons"> <button onclick="closeModal('enhanced-export-modal')">取消</button> <button onclick="downloadEnhancedData()">下载文件</button> </div> </div> </div> <div id="enhanced-import-modal" class="modal"> <div class="modal-content"> <div class="modal-header"> <h3>导入数据 - 详细预览</h3> <button class="modal-close" onclick="closeModal('enhanced-import-modal')">&times;</button> </div> <p>选择要导入的JSON文件：</p> <input type="file" id="import-files" accept=".json" style="margin: 15px 0;"> <div id="import-preview" style="display: none; margin: 15px 0;"> <h4>导入预览 - 请选择要导入的分类</h4> <div class="import-categories" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 5px; padding: 10px;"> <div class="import-category-section" style="margin-bottom: 15px;"> <div style="display: flex; align-items: center; justify-content: space-between;"> <strong>每日成就 (共 <span id="import-achievements-count">0</span> 条)</strong> <label class="export-category-label" style="display: flex; align-items: center; gap: 8px;"> <span style="font-size: 0.85rem;">全选</span> <input type="checkbox" id="import-all-achievements" class="import-category-checkbox" checked> </label> </div> <div id="import-achievements-details" style="margin-left: 10px; font-size: 0.9rem; color: #666;"> </div> </div> <div class="import-category-section"> <label style="display: flex; align-items: center; justify-content: space-between;"> <strong>技能成长 (共 <span id="import-skills-count">0</span> 项)</strong> <label class="export-category-label" style="display: flex; align-items: center; gap: 8px;"> <span style="font-size: 0.85rem;">全选</span> <input type="checkbox" id="import-all-skills" class="import-category-checkbox" checked> </label> </div> <div id="import-skills-details" style="margin-left: 10px; font-size: 0.9rem; color: #666;"> </div> <div class="import-category-section"> <label style="display: flex; align-items: center; justify-content: space-between;"> <strong>自我对话 (共 <span id="import-reflections-count">0</span> 条)</strong> <label class="export-category-label" style="display: flex; align-items: center; gap: 8px;"> <span style="font-size: 0.85rem;">全选</span> <input type="checkbox" id="import-all-reflections" class="import-category-checkbox" checked> </label> </div> <div id="import-reflections-details" style="margin-left: 10px; font-size: 0.9rem; color: #666;"> </div> <div class="import-category-section" style="margin-bottom: 15px;"> <div style="display: flex; align-items: center; justify-content: space-between;"> <strong>创造价值 (共 <span id="import-value-count">0</span> 条)</strong> <label class="export-category-label" style="display: flex; align-items: center; gap: 8px;"> <span style="font-size: 0.85rem;">全选</span> <input type="checkbox" id="import-all-value" class="import-category-checkbox" checked> </label> </div> <div id="import-value-details" style="margin-left: 10px; font-size: 0.9rem; color: #666;"> </div> </div> </div> <div id="import-summary" style="margin-top: 15px; padding: 10px; background: #f5f5f5; border-radius: 5px;"> <strong>导入统计：</strong> <span id="import-total-count">0</span> 条记录，预计占用 <span id="import-total-size">0</span> KB </div> </div> <div id="import-progress" style="display: none;"> <div class="progress-bar"> <div class="progress" id="import-progress-bar" style="width: 0%"></div> </div> <p id="import-progress-text">处理中...</p> </div> <div id="import-results" style="max-height: 200px; overflow-y: auto; margin: 10px 0;"></div> <div class="action-buttons"> <button onclick="closeModal('enhanced-import-modal')">取消</button> <button id="start-import-btn" onclick="importMultipleData()" disabled>开始导入</button> </div> </div> </div> <div id="reset-modal" class="modal"> <div class="modal-content"> <div class="modal-header"> <h3>选择性重置数据</h3> <button class="modal-close" onclick="closeModal('reset-modal')">&times;</button> </div> <p>请选择要重置的数据分类和日期范围：</p> <div class="reset-categories" style="margin: 15px 0;"> <h4>选择分类</h4> <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;"> <label style="display: flex; align-items: center; justify-content: space-between;"> <span>每日成就</span> <input type="checkbox" id="reset-achievements" class="reset-category-checkbox"> </label> <label style="display: flex; align-items: center; justify-content: space-between;"> <span>技能成长</span> <input type="checkbox" id="reset-skills" class="reset-category-checkbox"> </label> <label style="display: flex; align-items: center; justify-content: space-between;"> <span>自我对话</span> <input type="checkbox" id="reset-reflections" class="reset-category-checkbox"> </label> <label style="display: flex; align-items: center; justify-content: space-between;"> <span>创造价值</span> <input type="checkbox" id="reset-value" class="reset-category-checkbox"> </label> </div> </div> <div class="reset-date-range" style="margin: 15px 0;"> <h4>日期范围（可选）</h4> <label style="display: flex; align-items: center; justify-content: space-between; margin-top: 8px;"> <span>重置所有日期</span> <input type="checkbox" id="reset-all-dates"> </label> <div class="date-range-inputs"> <input type="date" id="reset-start-date"> <span>至</span> <input type="date" id="reset-end-date"> </div> </div> <div id="reset-summary" style="margin: 15px 0; padding: 15px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px;"> <h4>重置摘要</h4> <div id="reset-details"> <p>请选择要重置的分类...</p> </div> <div style="margin-top: 10px; font-weight: bold;"> 总计: <span id="reset-total-count">0</span> 条记录，释放约 <span id="reset-total-size">0</span> KB 空间 </div> </div> <div style="margin: 15px 0;"> <p>请输入密码确认重置：</p> <input type="password" id="reset-password" class="password-input" placeholder="请输入密码"> <div id="password-error" class="password-error">密码错误，请重新输入</div> </div> <div class="action-buttons"> <button onclick="closeModal('reset-modal')">取消</button> <button class="btn-danger" onclick="confirmResetData()" id="confirm-reset-btn" disabled>确认重置</button> </div> </div> </div> <div id="reminder-modal" class="modal"> <div class="modal-content"> <div class="modal-header"> <h3>数据备份提醒设置</h3> <button class="modal-close" onclick="closeModal('reminder-modal')">&times;</button> </div> <div class="reminder-options"> <h4>提醒设置</h4> <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px;"> <label for="enable-reminder" style="margin: 0;">是否启用数据备份提醒→</label> <input type="checkbox" id="enable-reminder" onchange="toggleReminderDetails()"> </div> <div id="reminder-details" style="display: none; margin-top: 15px;"> <div class="reminder-type"> <label> <input type="radio" name="reminder-type" value="weekly" checked onchange="toggleReminderType()"> 每周提醒 </label> <label> <input type="radio" name="reminder-type" value="monthly" onchange="toggleReminderType()"> 每月提醒 </label> </div> <div id="weekly-reminder" class="reminder-details"> <label>选择星期几提醒：</label> <select id="reminder-weekday"> <option value="0">星期日</option> <option value="1">星期一</option> <option value="2">星期二</option> <option value="3">星期三</option> <option value="4">星期四</option> <option value="5">星期五</option> <option value="6">星期六</option> </select> </div> <div id="monthly-reminder" class="reminder-details" style="display: none;"> <label>选择每月几号提醒：</label> <select id="reminder-day"> </select> </div> </div> </div> <div class="action-buttons"> <button onclick="closeModal('reminder-modal')">取消</button> <button onclick="saveReminderSettings()">保存设置</button> </div> </div> </div> <div id="date-filter-modal" class="modal"> <div class="modal-content"> <div class="modal-header"> <h3>按日期筛选</h3> <button class="modal-close" onclick="closeModal('date-filter-modal')">&times;</button> </div> <div class="date-filter-tabs"> <div class="date-filter-tab active" data-filter-type="day">按日期</div> <div class="date-filter-tab" data-filter-type="month">按月份</div> <div class="date-filter-tab" data-filter-type="year">按年份</div> <div class="date-filter-tab" data-filter-type="range">日期范围</div> </div> <div id="date-filter-day" class="date-filter-content active"> <p>选择要筛选的日期：</p> <input type="date" id="date-filter-input" style="width: 100%; margin: 10px 0;"> <div class="action-buttons"> <button onclick="closeModal('date-filter-modal')">取消</button> <button onclick="applyDateFilter('day')">应用筛选</button> <button onclick="clearDateFilter()">清除筛选</button> </div> </div> <div id="date-filter-month" class="date-filter-content"> <p>选择要筛选的月份：</p> <input type="month" id="month-filter-input" style="width: 100%; margin: 10px 0;"> <div class="action-buttons"> <button onclick="closeModal('date-filter-modal')">取消</button> <button onclick="applyDateFilter('month')">应用筛选</button> <button onclick="clearDateFilter()">清除筛选</button> </div> </div> <div id="date-filter-year" class="date-filter-content"> <p>选择要筛选的年份：</p> <input type="number" id="year-filter-input" min="2000" max="2030" value="2023" style="width: 100%; margin: 10px 0;"> <div class="action-buttons"> <button onclick="closeModal('date-filter-modal')">取消</button> <button onclick="applyDateFilter('year')">应用筛选</button> <button onclick="clearDateFilter()">清除筛选</button> </div> </div> <div id="date-filter-range" class="date-filter-content"> <p>选择日期范围：</p> <div class="date-range-inputs"> <input type="date" id="start-date-input" placeholder="开始日期"> <input type="date" id="end-date-input" placeholder="结束日期"> </div> <div class="action-buttons"> <button onclick="closeModal('date-filter-modal')">取消</button> <button onclick="applyDateFilter('range')">应用筛选</button> <button onclick="clearDateFilter()">清除筛选</button> </div> </div> <div class="calendar-container" id="calendar-container"> </div> </div> </div> <script> let currentExportFormat = 'json'; let appData = { achievements: [], skills: [], reflections: [], valueOutputs: [], recordData: { recordDays: 0, recordDates: [] }, reminderSettings: { enabled: true, type: 'weekly', day: 6, lastReminded: null } };let currentSkillId; let currentEditItem = { type: null, id: null, skillId: null };function showPrivacyModal() { document.getElementById('privacy-modal').style.display = 'flex';}function openEditModal(type, id, skillId = null) { const handler = editHandlers[type]; if (!handler) { console.error('未知的编辑类型:', type); return; } let item; if (type === 'checkin') { item = handler.findItem(id, skillId); } else { const dataMap = { 'achievement': 'achievements', 'reflection': 'reflections', 'skill': 'skills', 'value': 'valueOutputs' }; item = appData[dataMap[type]].find(item => item.id === id); } if (!item) { alert('未找到要编辑的条目'); return; } currentEditItem = { type, id, skillId }; const elements = handler.getModalElements(); const contentElement = document.getElementById(elements.content); if (contentElement) { contentElement.value = handler.getContent(item); document.getElementById(elements.modal).style.display = 'flex'; }}function saveEditModal() { const { type, id, skillId } = currentEditItem; const handler = editHandlers[type]; if (!type || !id || !handler) { alert('编辑状态异常'); return; } const elements = handler.getModalElements(); const contentElement = document.getElementById(elements.content); const content = validateInput(contentElement.value, '内容'); if (content === null) return; if (!content) { alert('请输入内容'); return; } let item; if (type === 'checkin') { const skill = appData.skills.find(s => s.id === skillId); item = skill ? skill.checkins.find(c => c.id === id) : null; } else { const dataMap = { 'achievement': 'achievements', 'reflection': 'reflections', 'skill': 'skills', 'value': 'valueOutputs' }; item = appData[dataMap[type]].find(item => item.id === id); } if (!item) { alert('未找到要编辑的条目'); return; } let success = true; if (type === 'skill') { success = handler.setContent(item, content); if (!success) return; } else { handler.setContent(item, content); } if (type !== 'skill') {const datetime = getCurrentDateTime();const modificationRecord = { date: datetime.date, time: datetime.time}; if (!item.modificationHistory) { item.modificationHistory = []; } item.modificationHistory.push(modificationRecord); if (item.modificationHistory.length > 3) { item.modificationHistory = item.modificationHistory.slice(-3); } } saveData(); handler.render(); closeEditModal(type);}function closeEditModal(type) { const handler = editHandlers[type]; if (!handler) { console.error('未知的编辑类型:', type); return; } const elements = handler.getModalElements(); document.getElementById(elements.modal).style.display = 'none'; currentEditItem = { type: null, id: null, skillId: null };}const editHandlers = { achievement: { getContent: (item) => item.text, setContent: (item, content) => { item.text = content; }, getModalElements: () => ({ modal: 'edit-achievement-modal', content: 'edit-achievement-content' }), render: renderAchievements }, reflection: { getContent: (item) => item.text, setContent: (item, content) => { item.text = content; }, getModalElements: () => ({ modal: 'edit-reflection-modal', content: 'edit-reflection-content' }), render: renderReflections }, checkin: { getContent: (item) => item.content, setContent: (item, content) => { item.content = content; }, getModalElements: () => ({ modal: 'edit-checkin-modal', content: 'edit-checkin-content' }), render: renderSkills, findItem: (id, skillId) => { const skill = appData.skills.find(s => s.id === skillId); return skill ? skill.checkins.find(c => c.id === id) : null; } }, skill: { getContent: (item) => item.name, setContent: (item, content) => { if (appData.skills.some(s => s.id !== item.id && s.name === content)) { alert('已存在同名技能'); return false; } item.name = content; return true; }, getModalElements: () => ({ modal: 'edit-skill-modal', content: 'edit-skill-name' }), render: renderSkills }, value: { getContent: (item) => item.text, setContent: (item, content) => { item.text = content; }, getModalElements: () => ({ modal: 'edit-value-modal', content: 'edit-value-content' }), render: renderValueOutputs }};function showModal(modalId) { document.getElementById(modalId).style.display = 'flex';}function closeModal(modalId) { document.getElementById(modalId).style.display = 'none';}function getCurrentDateTime() { const now = new Date(); return { date: now.toLocaleDateString(), time: now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}), timestamp: now.getTime() };}function generateId() { return Date.now() + Math.floor(Math.random() * 1000);} let collapseState = { achievements: {}, skills: {}, reflection: {}, value: {} }; let searchKeyword = ''; let dateFilter = ''; let skillCategoryFilter = 'all'; function loadData() { const saved = localStorage.getItem('feedbackAssistantData'); if (saved) { try { appData = JSON.parse(saved); migrateData(); } catch (e) { console.error("解析保存的数据时出错:", e); } } updateStats(); renderAchievements(); renderSkills(); renderReflections(); renderValueOutputs(); checkRecordDays(); initSearchClearButton(); initHeaderControls(); checkReminder(); function restoreInputs() { const inputsToSave = [ 'new-achievement', 'new-skill', 'reflection-text', 'new-share', 'new-project', 'new-help', 'new-partnership' ]; inputsToSave.forEach(id => { const input = document.getElementById(id); if (input) { const savedValue = localStorage.getItem(`input_${id}`); if (savedValue) { input.value = savedValue; } input.addEventListener('input', function() { localStorage.setItem(`input_${id}`, this.value); }); } }); } restoreInputs(); } function checkReminder() { const settings = appData.reminderSettings; if (!settings.enabled) return; const datetime = getCurrentDateTime();const today = new Date(datetime.timestamp);const todayDate = today.getDate();const todayDay = today.getDay(); let shouldRemind = false; if (settings.type === 'weekly') { if (todayDay === settings.day) { shouldRemind = true; } } else if (settings.type === 'monthly') { if (todayDate === settings.day) { shouldRemind = true; } } if (shouldRemind) { const lastReminded = settings.lastReminded ? new Date(settings.lastReminded) : null; const todayString = today.toDateString(); if (!lastReminded || lastReminded.toDateString() !== todayString) { showReminder(); } } } function showReminder() { const header = document.getElementById('main-header'); header.classList.add('reminder'); header.querySelector('h1').textContent = '记得导出和备份数据'; header.querySelector('p').textContent = '点击此处恢复'; header.onclick = function() { hideReminder(); toggleHeaderControls(); }; } function hideReminder() { const header = document.getElementById('main-header'); header.classList.remove('reminder'); header.querySelector('h1').textContent = '正反馈成长助手'; header.querySelector('p').textContent = '记录成长，发现更好的自己'; header.onclick = function() { toggleHeaderControls(); }; appData.reminderSettings.lastReminded = new Date().toISOString(); saveData(); } function toggleHeaderControls() { const headerControls = document.querySelector('.header-controls'); headerControls.classList.toggle('visible'); } function initHeaderControls() { const headerControls = document.querySelector('.header-controls'); headerControls.classList.remove('visible'); } function updateSearchStatus() { const statusElement = document.getElementById('search-status'); const statusTextElement = document.getElementById('search-status-text'); if (searchKeyword) { let totalMatches = 0; appData.achievements.forEach(achievement => { if (isItemVisible(achievement, achievement.date)) { totalMatches++; } }); const countedSkills = new Set(); appData.skills.forEach(skill => { if (isSkillVisible(skill)) { if (!countedSkills.has(skill.id)) { countedSkills.add(skill.id); totalMatches++; } skill.checkins.forEach(checkin => { if (isItemVisible(checkin, checkin.date)) { totalMatches++; } }); } }); appData.reflections.forEach(reflection => { if (isItemVisible(reflection, reflection.date)) { totalMatches++; } }); appData.valueOutputs.forEach(valueOutput => { if (isItemVisible(valueOutput, valueOutput.date)) { totalMatches++; } }); statusTextElement.textContent = `搜索关键词: "${searchKeyword}"，找到 ${totalMatches} 个匹配结果`; statusElement.style.display = 'block'; } else { statusElement.style.display = 'none'; } } function handleSearchKeypress(event) { if (event.key === 'Enter') { performSearch(); } } function initSearchClearButton() { const searchInput = document.getElementById('search-input'); const clearButton = document.getElementById('search-clear'); clearButton.addEventListener('click', function() { searchInput.value = ''; clearSearch(); }); } function clearSearch() { searchKeyword = ''; document.getElementById('search-input').value = ''; dateFilter = ''; renderAchievements(); renderSkills(); renderReflections(); renderValueOutputs(); document.getElementById('search-status').style.display = 'none'; } function fixMissingTimestamp(dateStr, timeStr) { try { let date = new Date(dateStr); if (isNaN(date.getTime())) { console.warn('无效日期格式，使用当前日期:', dateStr); date = new Date(); } if (timeStr && timeStr !== "未知时间") { const timeMatch = timeStr.match(/(\d+):(\d+)(?:\s*(AM|PM))?/i); if (timeMatch) { let hours = parseInt(timeMatch[1]); const minutes = parseInt(timeMatch[2]); const period = timeMatch[3]; if (period) { if (period.toUpperCase() === 'PM' && hours < 12) { hours += 12; } else if (period.toUpperCase() === 'AM' && hours === 12) { hours = 0; } } if (hours >= 0 && hours <= 23 && minutes >= 0 && minutes <= 59) { date.setHours(hours, minutes, 0, 0); } } } return date.getTime(); } catch (e) { console.error('修复时间戳失败，使用当前时间:', e); return new Date().getTime(); } }function filterByDateRange(records, startDate, endDate) { if (!startDate || !endDate) return records; const start = new Date(startDate); const end = new Date(endDate); end.setHours(23, 59, 59, 999); return records.filter(record => { const recordDate = new Date(record.date); return recordDate >= start && recordDate <= end; });} function validateInput(text, fieldName) { const trimmed = text.trim(); if (!trimmed) { alert(`请输入${fieldName}`); return null; } return trimmed;} function migrateData() { appData.achievements.forEach(achievement => { if (!achievement.time) { achievement.time = "未知时间"; } if (!achievement.timestamp) { achievement.timestamp = fixMissingTimestamp(achievement.date, achievement.time); } else if (achievement.timestamp instanceof Date) { achievement.timestamp = achievement.timestamp.getTime(); } }); appData.reflections.forEach(reflection => { if (!reflection.time) { reflection.time = "未知时间"; } if (!reflection.timestamp) { reflection.timestamp = fixMissingTimestamp(reflection.date, reflection.time); } else if (reflection.timestamp instanceof Date) { reflection.timestamp = reflection.timestamp.getTime(); } }); appData.valueOutputs.forEach(valueOutput => { if (!valueOutput.time) { valueOutput.time = "未知时间"; } if (!valueOutput.timestamp) { valueOutput.timestamp = fixMissingTimestamp(valueOutput.date, valueOutput.time); } else if (valueOutput.timestamp instanceof Date) { valueOutput.timestamp = valueOutput.timestamp.getTime(); } }); appData.skills.forEach(skill => { if (!skill.category) { skill.category = 'want'; } if (!skill.progressType) { skill.progressType = 'days'; } skill.checkins.forEach(checkin => { if (!checkin.time) { checkin.time = "未知时间"; } if (!checkin.timestamp) { checkin.timestamp = fixMissingTimestamp(checkin.date, checkin.time); } else if (checkin.timestamp instanceof Date) { checkin.timestamp = checkin.timestamp.getTime(); } }); }); if (!appData.recordData) { appData.recordData = { recordDays: appData.streakData ? appData.streakData.recordDates.length : 0, recordDates: appData.streakData ? appData.streakData.recordDates : [] }; delete appData.streakData; } if (!appData.reminderSettings) { appData.reminderSettings = { enabled: false, type: 'weekly', day: 5, lastReminded: null }; } saveData(); } function safeTextInput(text) { if (typeof text !== 'string') return text; return text .replace(/&/g, '&amp;') .replace(/</g, '&lt;') .replace(/>/g, '&gt;') .replace(/"/g, '&quot;') .replace(/'/g, '&#x27;') .replace(/\n/g, '<br>'); } function restoreTextDisplay(text) { if (typeof text !== 'string') return text; return text .replace(/&amp;/g, '&') .replace(/&lt;/g, '<') .replace(/&gt;/g, '>') .replace(/&quot;/g, '"') .replace(/&#x27;/g, "'") .replace(/<br>/g, '\n'); } function saveData() { localStorage.setItem('feedbackAssistantData', JSON.stringify(appData)); } function updateStats() { document.getElementById('achievement-count').textContent = appData.achievements.length; document.getElementById('skill-count').textContent = appData.skills.length; document.getElementById('record-days').textContent = appData.recordData.recordDays; const milestoneElement = document.getElementById('record-milestone'); const recordDays = appData.recordData.recordDays; if (recordDays >= 7 && recordDays < 30) { milestoneElement.textContent = "一周记录！"; } else if (recordDays >= 30 && recordDays < 100) { milestoneElement.textContent = "一月记录！"; } else if (recordDays >= 100) { milestoneElement.textContent = "百日记录！"; } else { milestoneElement.textContent = ""; } } function checkRecordDays() { const recordDates = getAllRecordDates(); appData.recordData.recordDays = recordDates.length; appData.recordData.recordDates = recordDates; saveData(); } function getAllRecordDates() { const dates = new Set(); appData.achievements.forEach(achievement => { dates.add(achievement.date); }); appData.skills.forEach(skill => { skill.checkins.forEach(checkin => { dates.add(checkin.date); }); }); appData.reflections.forEach(reflection => { dates.add(reflection.date); }); appData.valueOutputs.forEach(valueOutput => { dates.add(valueOutput.date); }); return Array.from(dates); } document.querySelectorAll('.tab').forEach(tab => { tab.addEventListener('click', () => { document.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active')); tab.classList.add('active'); document.getElementById(tab.dataset.tab).classList.add('active'); }); });function addAchievement() { const input = document.getElementById('new-achievement'); const text = validateInput(input.value, '成就内容'); if (text === null) return;const datetime = getCurrentDateTime();const achievement = { id: generateId(), text: safeTextInput(text), date: datetime.date, time: datetime.time, timestamp: datetime.timestamp, modificationHistory: []}; appData.achievements.unshift(achievement); input.value = ''; localStorage.removeItem('input_new-achievement'); saveData(); renderAchievements(); checkRecordDays();} function highlightText(text, keyword) { if (!keyword || !text) return text; const keywords = keyword.split(/\s+/).filter(word => word.length > 0); if (keywords.length === 0) return text; let highlightedText = text.toString(); keywords.forEach(keyword => { try { const regex = new RegExp(`(${keyword})`, 'gi'); highlightedText = highlightedText.replace(regex, '<span class="highlight">$1</span>'); } catch (e) { const escapedKeyword = keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); const regex = new RegExp(`(${escapedKeyword})`, 'gi'); highlightedText = highlightedText.replace(regex, '<span class="highlight">$1</span>'); } }); return highlightedText; }function groupItemsByDate(items) { const grouped = {}; items.forEach(item => { const date = item.date; if (!grouped[date]) { grouped[date] = []; } grouped[date].push(item); }); const sortedDates = Object.keys(grouped).sort((a, b) => { return new Date(b) - new Date(a); }); return { grouped, sortedDates };}function renderAchievements() { const list = document.getElementById('achievements-list'); const fragment = document.createDocumentFragment(); const searchStatus = document.getElementById('search-status'); const searchStatusText = document.getElementById('search-status-text'); if (appData.achievements.length === 0) { return; }const { grouped: achievementsByDate, sortedDates } = groupItemsByDate(appData.achievements); sortedDates.forEach(date => { const achievements = achievementsByDate[date].sort((a, b) => { const timeA = parseTimeString(a.time); const timeB = parseTimeString(b.time); return timeA - timeB; }); function parseTimeString(timeStr) { const [time, modifier] = timeStr.split(' '); let [hours, minutes] = time.split(':').map(Number); if (modifier === 'PM' && hours < 12) hours += 12; if (modifier === 'AM' && hours === 12) hours = 0; return hours * 60 + minutes; } const isCollapsed = collapseState.achievements[date] || false; const item = document.createElement('div'); item.className = 'achievement-item'; if (isCollapsed) { item.classList.add('collapsed'); } let achievementsHTML = ''; achievements.forEach((achievement, index) => { const isVisible = isItemVisible(achievement, date); if (!isVisible) return; let modificationHistoryHTML = ''; if (achievement.modificationHistory && achievement.modificationHistory.length > 0) { const recentModifications = achievement.modificationHistory.slice(-3); modificationHistoryHTML = ` <div class="modification-history"> 修改历史: ${recentModifications.map(mod => `${mod.date} ${mod.time}` ).join(', ')} </div> `; } const highlightedText = highlightText(restoreTextDisplay(achievement.text), searchKeyword); const highlightedDate = highlightText(achievement.date, searchKeyword); const highlightedTime = highlightText(achievement.time, searchKeyword); achievementsHTML += ` <div class="achievement-entry"> <div class="achievement-text"> ${index + 1}. ${highlightedText} <span class="achievement-time">${highlightedTime}</span> ${modificationHistoryHTML} </div> <div class="achievement-controls"> <button class="btn-edit" onclick="openEditModal('achievement', ${achievement.id})">修改</button> <button class="btn-danger" onclick="deleteItem('achievement', ${achievement.id})">删除</button> </div> </div> `; }); if (!achievementsHTML) return; item.innerHTML = ` <div class="achievement-date" onclick="toggleCollapse('achievements', '${date}')"> <span>${highlightText(date, searchKeyword)}</span> <span class="collapse-icon">▼</span> </div> <div class="collapsible-content"> <div class="achievement-list"> ${achievementsHTML} </div> </div> `; fragment.appendChild(item); });list.innerHTML = '';list.appendChild(fragment); } function isItemVisible(item, date) { if (dateFilter) { const itemDate = new Date(item.date); if (typeof dateFilter === 'string') { const filterDate = new Date(dateFilter); if (itemDate.toDateString() !== filterDate.toDateString()) return false; } else if (dateFilter.type === 'month') { const filterDate = new Date(dateFilter.value + '-01'); if (itemDate.getFullYear() !== filterDate.getFullYear() || itemDate.getMonth() !== filterDate.getMonth()) { return false; } } else if (dateFilter.type === 'year') { if (itemDate.getFullYear() !== parseInt(dateFilter.value)) { return false; } } else if (dateFilter.type === 'range') { const startDate = new Date(dateFilter.start); const endDate = new Date(dateFilter.end); endDate.setHours(23, 59, 59, 999); if (itemDate < startDate || itemDate > endDate) { return false; } } } if (!searchKeyword) return true; const keywords = searchKeyword.split(/\s+/).filter(word => word.length > 0); if (keywords.length === 0) return true; const searchableText = [ item.text, item.date, item.time, item.category, item.name, item.content ].filter(Boolean).join(' ').toLowerCase(); return keywords.every(keyword => { const lowerKeyword = keyword.toLowerCase(); try { const regex = new RegExp(lowerKeyword, 'i'); return regex.test(searchableText); } catch (e) { return searchableText.includes(lowerKeyword); } }); }function isSkillVisible(skill) { if (searchKeyword) { const keyword = searchKeyword.toLowerCase(); const nameMatch = skill.name.toLowerCase().includes(keyword); let checkinMatch = false; let matchedCheckins = []; skill.checkins.forEach(checkin => { if (checkin.content.toLowerCase().includes(keyword) || checkin.date.toLowerCase().includes(keyword)) { checkinMatch = true; matchedCheckins.push(checkin.id); } }); if (nameMatch || checkinMatch) { skill._matchedCheckins = matchedCheckins; return true; } return false; } if (dateFilter) { let hasVisibleCheckins = false; skill.checkins.forEach(checkin => { const checkinDate = new Date(checkin.date); if (typeof dateFilter === 'string') { const filterDate = new Date(dateFilter); if (checkinDate.toDateString() === filterDate.toDateString()) { hasVisibleCheckins = true; } } else if (dateFilter.type === 'month') { const filterDate = new Date(dateFilter.value + '-01'); if (checkinDate.getFullYear() === filterDate.getFullYear() && checkinDate.getMonth() === filterDate.getMonth()) { hasVisibleCheckins = true; } } else if (dateFilter.type === 'year') { if (checkinDate.getFullYear() === parseInt(dateFilter.value)) { hasVisibleCheckins = true; } } else if (dateFilter.type === 'range') { const startDate = new Date(dateFilter.start); const endDate = new Date(dateFilter.end); endDate.setHours(23, 59, 59, 999); if (checkinDate >= startDate && checkinDate <= endDate) { hasVisibleCheckins = true; } } }); return hasVisibleCheckins; } return true;} function toggleCollapse(type, key) { if (!collapseState[type]) { collapseState[type] = {}; } collapseState[type][key] = !collapseState[type][key]; if (type === 'achievements') { renderAchievements(); } else if (type === 'skills') { renderSkills(); } else if (type === 'reflection') { renderReflections(); } else if (type === 'value') { renderValueOutputs(); } } function toggleAllCollapsible(type) { if (!collapseState[type]) { collapseState[type] = {}; } let hasExpanded = false; Object.values(collapseState[type]).forEach(state => { if (!state) hasExpanded = true; }); if (Object.keys(collapseState[type]).length === 0) { hasExpanded = true; } if (type === 'achievements') { const achievementsByDate = {}; appData.achievements.forEach(achievement => { const date = achievement.date; achievementsByDate[date] = true; }); Object.keys(achievementsByDate).forEach(date => { collapseState.achievements[date] = hasExpanded; }); } else if (type === 'skills') { appData.skills.forEach(skill => { collapseState.skills[skill.id] = hasExpanded; }); } else if (type === 'reflection') { const reflectionsByDate = {}; appData.reflections.forEach(reflection => { const date = reflection.date; reflectionsByDate[date] = true; }); Object.keys(reflectionsByDate).forEach(date => { collapseState.reflection[date] = hasExpanded; }); } else if (type === 'value') { const outputsByCategory = {}; appData.valueOutputs.forEach(output => { const category = output.category; outputsByCategory[category] = true; }); Object.keys(outputsByCategory).forEach(category => { collapseState.value[category] = hasExpanded; }); } if (type === 'achievements') { renderAchievements(); } else if (type === 'skills') { renderSkills(); } else if (type === 'reflection') { renderReflections(); } else if (type === 'value') { renderValueOutputs(); } }function showSkillActionModal() { const input = document.getElementById('new-skill'); const text = validateInput(input.value, '技能名称或打卡内容'); if (text === null) { input.focus(); return; } if (!text) { alert('请输入技能名称或打卡内容'); input.focus(); return; } const select = document.getElementById('skill-action-select'); select.innerHTML = '<option value="new">新技能</option>'; appData.skills.forEach(skill => { const option = document.createElement('option'); option.value = skill.id; option.textContent = skill.name; select.appendChild(option); }); document.getElementById('skill-action-modal').style.display = 'flex';}function processSkillAction() { const select = document.getElementById('skill-action-select'); const selectedValue = select.value; const input = document.getElementById('new-skill'); const text = input.value.trim(); if (selectedValue === 'new') { addSkill(text); input.value = ''; localStorage.removeItem('input_new-skill'); } else { const skillId = parseInt(selectedValue); const skill = appData.skills.find(s => s.id === skillId); if (skill) { const now = new Date(); const checkin = { id: generateId(), content: text, date: now.toLocaleDateString(), time: now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}), timestamp: now.getTime(), modificationHistory: [] }; skill.checkins.unshift(checkin); saveData(); renderSkills(); checkRecordDays(); input.value = ''; localStorage.removeItem('input_new-skill'); } } closeModal('skill-action-modal');} function addSkill(skillName) { const text = skillName || document.getElementById('new-skill').value.trim(); if (text) { if (appData.skills.some(skill => skill.name === text)) { alert('已存在同名技能'); return; } const skill = { id: generateId(), name: text, progress: 0, checkins: [], category: 'want' }; appData.skills.push(skill); document.getElementById('new-skill').value = ''; saveData(); skillCategoryFilter = 'all'; updateSkillCategoryButtons(); renderSkills(); } else { alert('请输入技能名称'); } } function renderSkills() { const list = document.getElementById('skills-list'); const fragment = document.createDocumentFragment(); const skillCategoryButtons = document.querySelectorAll('.skill-category-button'); updateSkillCategoryButtons(); appData.skills.sort((a, b) => { const aLatest = a.checkins.length > 0 ? Math.max(...a.checkins.map(c => c.timestamp)) : a.id; const bLatest = b.checkins.length > 0 ? Math.max(...b.checkins.map(c => c.timestamp)) : b.id; return bLatest - aLatest; }); if (appData.skills.length === 0) { return; } let filteredSkills = appData.skills; if (skillCategoryFilter !== 'all') { filteredSkills = appData.skills.filter(skill => skill.category === skillCategoryFilter); } filteredSkills = filteredSkills.filter(skill => isSkillVisible(skill)); if (filteredSkills.length === 0) { const emptyState = document.createElement('div'); emptyState.className = 'empty-state'; emptyState.textContent = '没有找到匹配的技能记录'; list.appendChild(emptyState); return; } filteredSkills.forEach(skill => {let progressValue, progressText;if (skill.progressType === 'count') { progressValue = Math.min(skill.checkins.length, 100); progressText = `进度: ${skill.checkins.length}/100条`;} else { const uniqueDays = new Set(skill.checkins.map(checkin => checkin.date)).size; progressValue = Math.min(uniqueDays, 100); progressText = `进度: ${uniqueDays}/100天`;}skill.progress = progressValue; if (skill.progress >= 100 && skill.category !== 'completed') { skill.category = 'completed'; saveData(); } const isCollapsed = collapseState.skills[skill.id] || false; const item = document.createElement('div'); item.className = 'skill-item'; if (skill.category === 'completed') { item.classList.add('skill-category-completed'); } else if (skill.category === 'focus') { item.classList.add('skill-category-focus'); } else { item.classList.add('skill-category-want'); } if (isCollapsed) { item.classList.add('collapsed'); }const { grouped: checkinsByDate, sortedDates } = groupItemsByDate(skill.checkins); let checkinsHTML = ''; sortedDates.forEach(date => { const dayCheckins = checkinsByDate[date].sort((a, b) => { return a.timestamp - b.timestamp; }); let dayCheckinsHTML = `<div class="achievement-date"><span>${highlightText(date, searchKeyword)}</span></div>`; dayCheckins.forEach((checkin, index) => { const isVisible = isItemVisible(checkin, date); if (!isVisible) return; let modificationHistoryHTML = ''; if (checkin.modificationHistory && checkin.modificationHistory.length > 0) { const recentModifications = checkin.modificationHistory.slice(-3); modificationHistoryHTML = ` <div class="modification-history"> 修改历史: ${recentModifications.map(mod => `${mod.date} ${mod.time}` ).join(', ')} </div> `; } const highlightedContent = highlightText(checkin.content, searchKeyword); const highlightedTime = highlightText(checkin.time, searchKeyword); dayCheckinsHTML += ` <div class="achievement-entry"> <div class="achievement-text"> <span>${index + 1}. </span> <span class="checkin-text">${highlightedContent}</span> <span class="achievement-time">${highlightedTime}</span> ${modificationHistoryHTML} </div> <div class="achievement-controls"> <button class="btn-edit" onclick="openEditModal('checkin', ${checkin.id}, ${skill.id})">修改</button> <button class="btn-danger" onclick="deleteItem('checkin', ${checkin.id}, ${skill.id})">删除</button> </div> </div> `; }); if (dayCheckinsHTML !== `<div class="achievement-date">${highlightText(date, searchKeyword)}</div>`) { checkinsHTML += dayCheckinsHTML; } }); const highlightedSkillName = highlightText(skill.name, searchKeyword); let categoryLabel = ''; if (skill.category === 'completed') { categoryLabel = '<span class="skill-category-label category-completed" onclick="event.stopPropagation(); cycleSkillCategory(' + skill.id + ')">已完成</span>'; } else if (skill.category === 'focus') { categoryLabel = '<span class="skill-category-label category-focus" onclick="event.stopPropagation(); cycleSkillCategory(' + skill.id + ')">近期重点</span>'; } else { categoryLabel = '<span class="skill-category-label category-want" onclick="event.stopPropagation(); cycleSkillCategory(' + skill.id + ')">想学</span>'; } item.innerHTML = ` <div class="skill-header" onclick="toggleCollapse('skills', ${skill.id})"> <h3>${highlightedSkillName} ${categoryLabel}</h3> <div class="skill-header-controls"> <span class="collapse-icon">▼</span> <button class="btn-edit" onclick="openEditModal('skill', ${skill.id})">改名</button> <button class="btn-danger" onclick="deleteItem('skill', ${skill.id})">删除</button> </div> </div> <div class="collapsible-content"><div class="progress-bar" onclick="toggleProgressType(${skill.id})" style="cursor: pointer;" title="点击切换统计方式"> <div class="progress" style="width: ${progressValue}%"></div></div><p onclick="toggleProgressType(${skill.id})" style="cursor: pointer; margin: 5px 0;" title="点击切换统计方式">${progressText}</p> <div class="skill-controls"> <button onclick="openCheckinModal(${skill.id})">打卡</button> </div> ${skill.checkins.length > 0 ? `<div class="achievement-list" style="margin-top: 15px;">${checkinsHTML}</div>` : ''} </div> `; fragment.appendChild(item);}); list.innerHTML = '';list.appendChild(fragment); }function toggleProgressType(skillId) { const skill = appData.skills.find(s => s.id === skillId); if (skill) { skill.progressType = skill.progressType === 'days' ? 'count' : 'days'; saveData(); renderSkills(); }} function updateSkillCategoryButtons() { document.querySelectorAll('.skill-category-button').forEach(button => { button.classList.remove('active'); if (button.getAttribute('data-category') === skillCategoryFilter) { button.classList.add('active'); } });} function cycleSkillCategory(skillId) { const skill = appData.skills.find(s => s.id === skillId); if (skill) { const categoryCycle = { 'want': 'focus', 'focus': 'completed', 'completed': 'want' }; skill.category = categoryCycle[skill.category] || 'want'; saveData(); renderSkills(); } } function openCheckinModal(skillId) { currentSkillId = skillId; const skill = appData.skills.find(s => s.id === skillId); document.getElementById('checkin-skill-name').textContent = `为"${skill.name}"打卡`; document.getElementById('checkin-content').value = ''; document.getElementById('checkin-modal').style.display = 'flex'; }function submitCheckin() { const content = validateInput(document.getElementById('checkin-content').value, '打卡内容'); if (content === null) return; if (!currentSkillId) { alert('未选择技能'); return; } const skill = appData.skills.find(s => s.id === currentSkillId); if (skill) { const uniqueDays = new Set(skill.checkins.map(checkin => checkin.date)).size; if (uniqueDays >= 100) { alert('该技能已达到100天打卡，已完成学习目标！'); } const datetime = getCurrentDateTime();const checkin = { id: generateId(), content: content, date: datetime.date, time: datetime.time, timestamp: datetime.timestamp, modificationHistory: []}; skill.checkins.unshift(checkin); saveData(); renderSkills(); closeModal('checkin-modal'); checkRecordDays(); appData.skills.sort((a, b) => { const aLatest = a.checkins.length > 0 ? Math.max(...a.checkins.map(c => c.timestamp)) : a.id; const bLatest = b.checkins.length > 0 ? Math.max(...b.checkins.map(c => c.timestamp)) : b.id; return bLatest - aLatest; }); renderSkills(); } }function saveReflection() { const textarea = document.getElementById('reflection-text'); const text = validateInput(textarea.value, '反思内容'); if (text === null) return; if (text) {const datetime = getCurrentDateTime();const reflection = { id: generateId(), text: text, date: datetime.date, time: datetime.time, timestamp: datetime.timestamp, modificationHistory: []}; appData.reflections.unshift(reflection); textarea.value = ''; localStorage.removeItem('input_reflection-text'); saveData(); renderReflections(); checkRecordDays(); } else { alert('请输入反思内容'); } }function insertDiaryTemplate() {
    const template = `「微光成长日记」
🌱 今日微光时刻
今天，我留意到：（记录一件具体的小事）
这让我感觉： （描述当时的细微感受，如“心里暖了一下”、“松了口气”、“有点小得意”）

✨ 我的进步痕迹
（可自行删改）
尝试了新事物（哪怕只是换条路回家、尝一道新菜）
多了一点耐心（对自己、对他人、对某件事）
吸收了一点新知（看了一页书、学到一个冷知识、有了一点小感悟）
心态更松弛了（放过了一件小事、不再纠结某个问题）
行动力+1（动手处理了一件拖延的小事）
传递了一点善意（一个微笑、一句感谢、一次随手帮助）
照顾好了自己（好好吃饭、及时休息、允许自己放松）

进步小结： 今天我收获了 ____ 个小小的进步痕迹。

💭 一念之转
（如果今天有感到困扰或自责的时刻，试着用一个新的角度看看它？可选填，不评判自己）
困扰我的小事：
我尝试换个角度看：

🌟 明日小期待
（为明天设定一个简单、轻松、无压力的小期待，让生活有盼头）
我有点期待明天：（如：更新的播客、晚上要看的剧、散步时的微风）


`; const textarea = document.getElementById('reflection-text'); textarea.value = template; textarea.focus();} function renderReflections() { const list = document.getElementById('reflection-list'); const fragment = document.createDocumentFragment(); if (appData.reflections.length === 0) { return; }const { grouped: reflectionsByDate, sortedDates } = groupItemsByDate(appData.reflections); sortedDates.forEach(date => { const reflections = reflectionsByDate[date]; const isCollapsed = collapseState.reflection[date] || false; const item = document.createElement('div'); item.className = 'reflection-item'; if (isCollapsed) { item.classList.add('collapsed'); } let reflectionsHTML = ''; reflections.forEach(reflection => { const isVisible = isItemVisible(reflection, date); if (!isVisible) return; let modificationHistoryHTML = ''; if (reflection.modificationHistory && reflection.modificationHistory.length > 0) { const recentModifications = reflection.modificationHistory.slice(-3); modificationHistoryHTML = ` <div class="modification-history"> 修改历史: ${recentModifications.map(mod => `${mod.date} ${mod.time}` ).join(', ')} </div> `; } const highlightedText = highlightText(reflection.text, searchKeyword); const highlightedTime = highlightText(reflection.time, searchKeyword); const firstSentence = reflection.text.split(/[，。！？\n.,]/)[0].trim(); const title = firstSentence || reflection.text.substring(0, 30) + (reflection.text.length > 30 ? '...' : ''); const firstLine = reflection.text.split('\n')[0].trim(); const isTitleCompleteFirstLine = (title === firstLine); let displayText = highlightedText; if (isTitleCompleteFirstLine) { const lines = reflection.text.split('\n'); if (lines.length > 1) { displayText = highlightText(lines.slice(1).join('\n'), searchKeyword); } else { displayText = ''; } } reflectionsHTML += ` <div class="reflection-title">${title}</div> <div class="reflection-content"> ${displayText ? `<div class="reflection-text">${displayText}</div>` : ''} </div> <div class="reflection-meta"> <div style="color: #888; font-size: 0.8rem;">记录时间: ${highlightedTime}</div> ${modificationHistoryHTML} <div class="skill-controls"> <button class="btn-edit" onclick="openEditModal('reflection', ${reflection.id})">修改</button> <button class="btn-danger" onclick="deleteItem('reflection', ${reflection.id})">删除</button> </div> </div> `; }); if (!reflectionsHTML) return; item.innerHTML = ` <div class="achievement-date" onclick="toggleCollapse('reflection', '${date}')"> <span>${highlightText(date, searchKeyword)}</span> <span class="collapse-icon">▼</span> </div> <div class="collapsible-content"> ${reflectionsHTML} </div> `; fragment.appendChild(item);}); list.innerHTML = '';list.appendChild(fragment); }function addValueOutput(type) { let inputId, categoryName; switch(type) { case 'share': inputId = 'new-share'; categoryName = '知识分享'; break; case 'project': inputId = 'new-project'; categoryName = '完成小项目'; break; case 'help': inputId = 'new-help'; categoryName = '提供无偿帮助'; break; case 'partnership': inputId = 'new-partnership'; categoryName = '外部支持与反馈'; break; default: return; } const input = document.getElementById(inputId); const text = validateInput(input.value, categoryName); if (text === null) return; if (text) {const datetime = getCurrentDateTime();const valueOutput = { id: generateId(), type: type, category: categoryName, text: text, date: datetime.date, time: datetime.time, timestamp: datetime.timestamp, modificationHistory: []}; appData.valueOutputs.unshift(valueOutput); input.value = ''; localStorage.removeItem(`input_${inputId}`); saveData(); renderValueOutputs(); checkRecordDays(); } else { alert('请输入内容'); } } function renderValueOutputs() { const list = document.getElementById('value-outputs-list'); const fragment = document.createDocumentFragment(); if (appData.valueOutputs.length === 0) { return; } const outputsByCategory = {}; appData.valueOutputs.forEach(output => { const category = output.category; if (!outputsByCategory[category]) { outputsByCategory[category] = []; } outputsByCategory[category].push(output); }); Object.keys(outputsByCategory).forEach(category => { const outputs = outputsByCategory[category]; const isCollapsed = collapseState.value[category] || false; const item = document.createElement('div'); item.className = 'value-output-item'; if (isCollapsed) { item.classList.add('collapsed'); } let outputsHTML = ''; outputs.forEach((output, index) => { const isVisible = isItemVisible(output, output.date); if (!isVisible) return; let modificationHistoryHTML = ''; if (output.modificationHistory && output.modificationHistory.length > 0) { const recentModifications = output.modificationHistory.slice(-3); modificationHistoryHTML = ` <div class="modification-history"> 修改历史: ${recentModifications.map(mod => `${mod.date} ${mod.time}` ).join(', ')} </div> `; } const highlightedText = highlightText(output.text, searchKeyword); const highlightedCategory = highlightText(output.category, searchKeyword); const highlightedDate = highlightText(output.date, searchKeyword); const highlightedTime = highlightText(output.time, searchKeyword); outputsHTML += `<div class="value-output-entry"> <div class="value-output-content"> <div class="achievement-entry"> <div class="achievement-text"> <span>${index + 1}. </span> <span class="value-text">${highlightedText}</span> </div> </div> </div> <div class="value-output-meta"> <div style="margin-bottom: 8px; font-size: 0.85rem; color: #666;"> <span>${highlightedDate} ${highlightedTime}</span> </div> ${modificationHistoryHTML} <div class="achievement-controls" style="margin-top: 8px;"> <button class="btn-edit" onclick="openEditModal('value', ${output.id})">修改</button> <button class="btn-danger" onclick="deleteItem('value', ${output.id})">删除</button> </div> </div></div>`; }); if (!outputsHTML) return; const highlightedCategory = highlightText(category, searchKeyword); item.innerHTML = ` <div class="value-output-header" onclick="toggleCollapse('value', '${category}')"> <h3>${highlightedCategory}</h3> <div class="value-output-header-controls"> <span class="collapse-icon">▼</span> </div> </div> <div class="collapsible-content"> ${outputsHTML} </div> `; fragment.appendChild(item);}); list.innerHTML = '';list.appendChild(fragment); }function deleteItem(type, id, skillId = null) { const config = { achievement: { message: '确定要删除这个成就吗？', data: 'achievements', render: renderAchievements }, reflection: { message: '确定要删除这条反思吗？', data: 'reflections', render: renderReflections }, checkin: { message: '确定要删除这条打卡记录吗？', render: renderSkills }, skill: { message: '确定要删除这个技能吗？', data: 'skills', render: renderSkills }, value: { message: '确定要删除这条价值输出吗？', data: 'valueOutputs', render: renderValueOutputs } }; const itemConfig = config[type]; if (!itemConfig) { console.error('未知的删除类型:', type); return; } if (confirm(itemConfig.message)) { let success = false; if (type === 'checkin') { if (skillId) { const skill = appData.skills.find(s => s.id === skillId); if (skill) { skill.checkins = skill.checkins.filter(c => c.id !== id); success = true; } } } else { appData[itemConfig.data] = appData[itemConfig.data].filter(item => item.id !== id); success = true; } if (success) { saveData(); checkRecordDays(); itemConfig.render(); } }} function getDateRange() { let earliest = null; let latest = null; appData.achievements.forEach(achievement => { const date = new Date(achievement.date); if (!earliest || date < earliest) earliest = date; if (!latest || date > latest) latest = date; }); appData.skills.forEach(skill => { skill.checkins.forEach(checkin => { const date = new Date(checkin.date); if (!earliest || date < earliest) earliest = date; if (!latest || date > latest) latest = date; }); }); appData.reflections.forEach(reflection => { const date = new Date(reflection.date); if (!earliest || date < earliest) earliest = date; if (!latest || date > latest) latest = date; }); appData.valueOutputs.forEach(valueOutput => { const date = new Date(valueOutput.date); if (!earliest || date < earliest) earliest = date; if (!latest || date > latest) latest = date; }); function formatDate(date) { if (!date) return ''; const year = date.getFullYear(); const month = String(date.getMonth() + 1).padStart(2, '0'); const day = String(date.getDate()).padStart(2, '0'); return `${year}-${month}-${day}`; } return { earliest: formatDate(earliest), latest: formatDate(latest) }; } function showEnhancedExportModal() { const dateRange = getDateRange(); document.getElementById('export-start-date').value = dateRange.earliest; document.getElementById('export-end-date').value = dateRange.latest; document.querySelectorAll('.export-category-checkbox').forEach(checkbox => { checkbox.checked = true; }); currentExportFormat = 'json'; document.getElementById('preview-json-btn').classList.add('active'); document.getElementById('preview-md-btn').classList.remove('active'); document.getElementById('enhanced-export-modal').style.display = 'flex'; updateExportPreview(); document.querySelectorAll('.export-category-checkbox').forEach(checkbox => { checkbox.addEventListener('change', updateExportPreview); }); document.getElementById('export-start-date').addEventListener('change', updateExportPreview); document.getElementById('export-end-date').addEventListener('change', updateExportPreview); } function copyExportFilename() { const filenameInput = document.getElementById('export-filename-display'); filenameInput.select(); document.execCommand('copy'); } function switchPreviewFormat(format) { currentExportFormat = format; document.getElementById('preview-json-btn').classList.toggle('active', format === 'json'); document.getElementById('preview-md-btn').classList.toggle('active', format === 'md'); updateExportPreview(); } function updateExportPreview() { const exportData = generateExportData(); if (currentExportFormat === 'json') { document.getElementById('enhanced-export-data').value = JSON.stringify(exportData, null, 2); } else { const markdownContent = generateMarkdownData(exportData); document.getElementById('enhanced-export-data').value = markdownContent; } const dateRange = getExportDateRange(exportData); const counts = getExportCounts(exportData); let fileName = '正反馈'; fileName += `_${dateRange.display}`; if (currentExportFormat === 'json') { fileName += `_${counts.achievements}成就+${counts.skills}技能+${counts.reflections}反思+${counts.valueOutputs}创造.json`; } else { fileName += `_${counts.achievements}ach+${counts.skills}skl+${counts.reflections}ref+${counts.valueOutputs}val.md`; } document.getElementById('export-filename-display').value = fileName; } function generateExportData() { const startDateInput = document.getElementById('export-start-date').value; const endDateInput = document.getElementById('export-end-date').value; const includeAchievements = document.getElementById('export-achievements').checked; const includeSkills = document.getElementById('export-skills').checked; const includeReflections = document.getElementById('export-reflections').checked; const includeValueOutputs = document.getElementById('export-value').checked; const exportData = { achievements: [], skills: [], reflections: [], valueOutputs: [], recordData: { recordDays: 0, recordDates: [] }, exportInfo: { exportedAt: new Date().toISOString(), dateRange: { start: startDateInput, end: endDateInput }, categories: { achievements: includeAchievements, skills: includeSkills, reflections: includeReflections, valueOutputs: includeValueOutputs } } }; let start, end; if (startDateInput && endDateInput) { start = new Date(startDateInput); start.setHours(0,0,0,0); end = new Date(endDateInput); end.setHours(23,59,59,999); }if (includeAchievements) { exportData.achievements = filterByDateRange(appData.achievements, startDateInput, endDateInput);} if (includeSkills) { exportData.skills = appData.skills.map(skill => { return { ...skill, checkins: filterByDateRange(skill.checkins, startDateInput, endDateInput) }; });} if (includeReflections) { exportData.reflections = filterByDateRange(appData.reflections, startDateInput, endDateInput);} if (includeValueOutputs) { exportData.valueOutputs = filterByDateRange(appData.valueOutputs, startDateInput, endDateInput);} if (startDateInput && endDateInput) { exportData.recordData.recordDates = appData.recordData.recordDates.filter(date => { const recordDate = new Date(date); return recordDate >= start && recordDate <= end; }); } else { exportData.recordData.recordDates = [...appData.recordData.recordDates]; } exportData.recordData.recordDays = exportData.recordData.recordDates.length; return exportData; } function getExportDateRange(exportData) { let earliest = null; let latest = null; exportData.achievements.forEach(item => { const date = new Date(item.date); if (!earliest || date < earliest) earliest = date; if (!latest || date > latest) latest = date; }); exportData.skills.forEach(skill => { skill.checkins.forEach(checkin => { const date = new Date(checkin.date); if (!earliest || date < earliest) earliest = date; if (!latest || date > latest) latest = date; }); }); exportData.reflections.forEach(item => { const date = new Date(item.date); if (!earliest || date < earliest) earliest = date; if (!latest || date > latest) latest = date; }); exportData.valueOutputs.forEach(item => { const date = new Date(item.date); if (!earliest || date < earliest) earliest = date; if (!latest || date > latest) latest = date; }); function formatDate(date) { if (!date) return '未知日期'; const year = date.getFullYear(); const month = String(date.getMonth() + 1).padStart(2, '0'); const day = String(date.getDate()).padStart(2, '0'); return `${year}${month}${day}`; } function formatDateForDisplay(date) { if (!date) return ''; const year = date.getFullYear(); const month = String(date.getMonth() + 1).padStart(2, '0'); const day = String(date.getDate()).padStart(2, '0'); return { year: year, month: month, day: day, full: `${year}${month}${day}` }; } const earliestFormatted = formatDateForDisplay(earliest); const latestFormatted = formatDateForDisplay(latest); return { earliest: earliestFormatted.full, latest: latestFormatted.full, display: earliest && latest ? (earliestFormatted.year === latestFormatted.year ? `${earliestFormatted.year}${earliestFormatted.month}${earliestFormatted.day}-${latestFormatted.month}${latestFormatted.day}` : `${earliestFormatted.full}-${latestFormatted.full}`) : (earliestFormatted.full || latestFormatted.full || '无日期') }; } function getExportCounts(exportData) { return { achievements: exportData.achievements.length, skills: exportData.skills.length, reflections: exportData.reflections.length, valueOutputs: exportData.valueOutputs.length }; } function generateMarkdownData(exportData) { const dateRange = getExportDateRange(exportData); const counts = getExportCounts(exportData); let markdown = '---\n'; markdown += `title: "正反馈成长记录 - ${dateRange.display}"\n`; markdown += `created: "${new Date().toISOString()}"\n`; markdown += `date_range: "${dateRange.earliest} 至 ${dateRange.latest}"\n`; markdown += `year: "${dateRange.earliest.substring(0,4)}"\n`; markdown += `export_source: "正反馈成长助手"\n`; markdown += `tags: ["正反馈", "成长记录", "个人发展", "${dateRange.earliest.substring(0,4)}年"]\n`; markdown += '---\n\n'; markdown += `# 正反馈成长记录\n\n`; markdown += `> 记录时间：${dateRange.earliest} 至 ${dateRange.latest}\n\n`; markdown += `## 📊 统计概览\n\n`; markdown += `- **成就记录**: ${counts.achievements} 条\n`; markdown += `- **技能追踪**: ${counts.skills} 项\n`; markdown += `- **自我对话**: ${counts.reflections} 条\n`; markdown += `- **价值输出**: ${counts.valueOutputs} 条\n\n`; if (exportData.achievements.length > 0) { markdown += `## 🌟 每日成就\n\n`; const { grouped: achievementsByDate } = groupItemsByDate(exportData.achievements); Object.keys(achievementsByDate).sort((a, b) => new Date(b) - new Date(a)).forEach(date => { markdown += `### ${date}\n\n`; achievementsByDate[date].forEach((achievement, index) => { markdown += `${index + 1}. ${achievement.text} _${achievement.time}_\n`; if (achievement.modificationHistory && achievement.modificationHistory.length > 0) { markdown += ` - 修改记录: ${achievement.modificationHistory.map(mod => `${mod.date} ${mod.time}`).join(', ')}\n`; } }); markdown += `\n`; }); } if (exportData.skills.length > 0) { markdown += `## 🚀 技能成长\n\n`; const skillsByCategory = { 'focus': [], 'want': [], 'completed': [] }; exportData.skills.forEach(skill => { skillsByCategory[skill.category] = skillsByCategory[skill.category] || []; skillsByCategory[skill.category].push(skill); }); if (skillsByCategory.focus.length > 0) { markdown += `### 🔥 近期重点\n\n`; skillsByCategory.focus.forEach(skill => { const uniqueDays = new Set(skill.checkins.map(checkin => checkin.date)).size; const progress = Math.min(uniqueDays, 100); markdown += `#### [[${skill.name}]]\n\n`; markdown += `- **进度**: ${progress}/100天\n`; markdown += `- **打卡次数**: ${skill.checkins.length}次\n\n`; if (skill.checkins.length > 0) { markdown += `**最近打卡记录：**\n\n`; skill.checkins.slice(0, 5).forEach(checkin => { markdown += `- ${checkin.date}：${checkin.content}\n`; }); if (skill.checkins.length > 5) { markdown += `*...还有 ${skill.checkins.length - 5} 条记录*\n`; } } markdown += '\n'; }); } if (skillsByCategory.want.length > 0) { markdown += `### 💭 想学技能\n\n`; skillsByCategory.want.forEach(skill => { const uniqueDays = new Set(skill.checkins.map(checkin => checkin.date)).size; markdown += `- [[${skill.name}]] - ${uniqueDays}天进度\n`; }); markdown += '\n'; } if (skillsByCategory.completed.length > 0) { markdown += `### ✅ 已完成技能\n\n`; skillsByCategory.completed.forEach(skill => { markdown += `- [[${skill.name}]] - 已完成 ${skill.checkins.length} 次打卡\n`; }); markdown += '\n'; } } if (exportData.reflections.length > 0) { markdown += `## 💭 自我对话\n\n`; const { grouped: reflectionsByDate } = groupItemsByDate(exportData.reflections); Object.keys(reflectionsByDate).sort((a, b) => new Date(b) - new Date(a)).forEach(date => { markdown += `### ${date}\n\n`; reflectionsByDate[date].forEach((reflection, index) => { const lines = reflection.text.split('\n'); const title = lines[0] || '未命名反思'; const content = lines.slice(1).join('\n'); markdown += `#### ${title}\n\n`; if (content.trim()) { markdown += `${content}\n\n`; } markdown += `_记录时间: ${reflection.time}_\n`; if (reflection.modificationHistory && reflection.modificationHistory.length > 0) { markdown += `- 修改记录: ${reflection.modificationHistory.map(mod => `${mod.date} ${mod.time}`).join(', ')}\n`; } markdown += `\n`; }); }); } if (exportData.valueOutputs.length > 0) { markdown += `## 💎 创造价值\n\n`; const outputsByCategory = {}; exportData.valueOutputs.forEach(output => { if (!outputsByCategory[output.category]) { outputsByCategory[output.category] = []; } outputsByCategory[output.category].push(output); }); Object.keys(outputsByCategory).forEach(category => { markdown += `### ${category}\n\n`; const outputsByDate = {}; outputsByCategory[category].forEach(output => { if (!outputsByDate[output.date]) { outputsByDate[output.date] = []; } outputsByDate[output.date].push(output); }); Object.keys(outputsByDate).sort((a, b) => new Date(b) - new Date(a)).forEach(date => { markdown += `#### ${date}\n\n`; outputsByDate[date].forEach((output, index) => { markdown += `${index + 1}. ${output.text} _${output.time}_\n`; if (output.modificationHistory && output.modificationHistory.length > 0) { markdown += ` - 修改记录: ${output.modificationHistory.map(mod => `${mod.date} ${mod.time}`).join(', ')}\n`; } }); markdown += `\n`; }); }); } markdown += `## 🔗 相关链接\n\n`; markdown += `- [[正反馈成长系统]] - 核心方法论\n`; markdown += `- [[个人发展仪表板]] - 整体进度\n`; markdown += `- [[技能成长地图]] - 技能发展路径\n`; if (dateRange.earliest) { markdown += `- [[${dateRange.earliest.substring(0,4)}年成长总结]] - 年度回顾\n\n`; } markdown += `## 🔄 自动链接\n\n`; markdown += `- 技能追踪:: ${counts.skills}项技能正在成长中\n`; markdown += `- 成就统计:: 已记录${counts.achievements}个成就时刻\n`; markdown += `- 反思实践:: ${counts.reflections}次深度思考\n`; markdown += `- 价值创造:: ${counts.valueOutputs}次价值输出\n\n`; markdown += `## 🏷️ 标签\n\n`; if (dateRange.earliest) { markdown += `#正反馈 #成长记录 #个人发展 #成就追踪 #${dateRange.earliest.substring(0,4)}年\n\n`; } else { markdown += `#正反馈 #成长记录 #个人发展 #成就追踪\n\n`; } markdown += `## 📂 分类\n\n`; if (counts.achievements > 0) markdown += `#成就记录 `; if (counts.skills > 0) markdown += `#技能成长 `; if (counts.reflections > 0) markdown += `#自我反思 `; if (counts.valueOutputs > 0) markdown += `#价值创造\n`; return markdown; } function getSkillCategoryName(category) { const categoryNames = { 'want': '想学', 'focus': '近期重点', 'completed': '已完成' }; return categoryNames[category] || category; } function downloadEnhancedData() { const exportData = generateExportData(); let dataStr, mimeType, fileExtension; if (currentExportFormat === 'json') { dataStr = JSON.stringify(exportData, null, 2); mimeType = 'application/json'; fileExtension = 'json'; } else { dataStr = generateMarkdownData(exportData); mimeType = 'text/markdown;charset=utf-8'; fileExtension = 'md'; } const dateRange = getExportDateRange(exportData); const counts = getExportCounts(exportData); let fileName = '正反馈'; fileName += `_${dateRange.display}`; if (currentExportFormat === 'json') { fileName += `_${counts.achievements}成就+${counts.skills}技能+${counts.reflections}反思+${counts.valueOutputs}创造.json`; } else { fileName += `_${counts.achievements}ach+${counts.skills}skl+${counts.reflections}ref+${counts.valueOutputs}val.md`; } const blob = new Blob([dataStr], { type: mimeType }); const url = URL.createObjectURL(blob); const link = document.createElement('a'); link.href = url; link.download = fileName; link.style.display = 'none'; document.body.appendChild(link); link.click(); setTimeout(() => { document.body.removeChild(link); URL.revokeObjectURL(url); }, 100); closeModal('enhanced-export-modal'); } function showEnhancedImportModal() { document.getElementById('import-files').value = ''; document.getElementById('import-preview').style.display = 'none'; document.getElementById('import-progress').style.display = 'none'; document.getElementById('import-results').innerHTML = ''; document.getElementById('start-import-btn').disabled = true; document.getElementById('enhanced-import-modal').style.display = 'flex'; const fileInput = document.getElementById('import-files'); fileInput.onchange = null; fileInput.addEventListener('change', function(event) { const files = event.target.files; if (files.length === 0) return; const file = files[0]; const reader = new FileReader(); reader.onload = function(e) { try { const importedData = JSON.parse(e.target.result); if (isValidDataFormat(importedData)) { generateImportPreview(importedData); showImportPreview(importedData, file.name); } else { throw new Error('文件格式不正确'); } } catch (error) { alert('文件解析失败: ' + error.message); console.error('导入错误:', error); } }; reader.onerror = function() { alert('文件读取失败'); }; reader.readAsText(file); }); } function showImportPreview(importedData, filename) { const preview = document.getElementById('import-preview'); const startBtn = document.getElementById('start-import-btn'); window.pendingImportData = importedData; updateImportPreview(importedData); preview.style.display = 'block'; startBtn.disabled = false; document.getElementById('import-all-achievements').addEventListener('change', function() { const checkboxes = document.querySelectorAll('#import-achievements-details input[type="checkbox"]'); checkboxes.forEach(checkbox => checkbox.checked = this.checked); updateImportPreview(importedData); }); document.getElementById('import-all-skills').addEventListener('change', function() { const checkboxes = document.querySelectorAll('#import-skills-details input[type="checkbox"]'); checkboxes.forEach(checkbox => checkbox.checked = this.checked); updateImportPreview(importedData); }); document.getElementById('import-all-reflections').addEventListener('change', function() { const checkboxes = document.querySelectorAll('#import-reflections-details input[type="checkbox"]'); checkboxes.forEach(checkbox => checkbox.checked = this.checked); updateImportPreview(importedData); }); document.getElementById('import-all-value').addEventListener('change', function() { const checkboxes = document.querySelectorAll('#import-value-details input[type="checkbox"]'); checkboxes.forEach(checkbox => checkbox.checked = this.checked); updateImportPreview(importedData); }); } function updateImportPreview(importedData) { let totalCount = 0; let selectedData = { achievements: [], skills: [], reflections: [], valueOutputs: [] }; if (importedData.achievements) { const dateCheckboxes = document.querySelectorAll('#import-achievements-details input[type="checkbox"]:checked'); if (dateCheckboxes.length > 0) { const selectedDates = Array.from(dateCheckboxes).map(cb => cb.dataset.date); selectedData.achievements = importedData.achievements.filter(item => selectedDates.includes(item.date) ); } totalCount += selectedData.achievements.length; } if (importedData.skills) { const skillCheckboxes = document.querySelectorAll('#import-skills-details input[type="checkbox"]:checked'); if (skillCheckboxes.length > 0) { const selectedSkills = Array.from(skillCheckboxes).map(cb => parseInt(cb.dataset.skillId)); selectedData.skills = importedData.skills.filter(skill => selectedSkills.includes(skill.id) ); } totalCount += selectedData.skills.length; } if (importedData.reflections) { const dateCheckboxes = document.querySelectorAll('#import-reflections-details input[type="checkbox"]:checked'); if (dateCheckboxes.length > 0) { const selectedDates = Array.from(dateCheckboxes).map(cb => cb.dataset.date); selectedData.reflections = importedData.reflections.filter(item => selectedDates.includes(item.date) ); } totalCount += selectedData.reflections.length; } if (importedData.valueOutputs) { const categoryCheckboxes = document.querySelectorAll('#import-value-details input[type="checkbox"]:checked'); if (categoryCheckboxes.length > 0) { const selectedCategories = Array.from(categoryCheckboxes).map(cb => cb.dataset.category); selectedData.valueOutputs = importedData.valueOutputs.filter(item => selectedCategories.includes(item.category) ); } totalCount += selectedData.valueOutputs.length; } const dataSize = JSON.stringify(selectedData).length / 1024; document.getElementById('import-total-count').textContent = totalCount; document.getElementById('import-total-size').textContent = dataSize.toFixed(2); window.selectedImportData = selectedData; } function generateImportPreview(importedData) { if (importedData.achievements && importedData.achievements.length > 0) { document.getElementById('import-achievements-count').textContent = importedData.achievements.length; const { grouped: achievementsByDate } = groupItemsByDate(importedData.achievements); let achievementsHTML = ''; Object.keys(achievementsByDate).sort((a, b) => new Date(b) - new Date(a)).forEach(date => { achievementsHTML += ` <label style="display: flex; align-items: center; justify-content: space-between; margin: 2px 0;"> <span>${date} (${achievementsByDate[date].length}条)</span> <input type="checkbox" data-date="${date}" checked> </label> `; }); document.getElementById('import-achievements-details').innerHTML = achievementsHTML; } else { document.getElementById('import-achievements-count').textContent = '0'; document.getElementById('import-achievements-details').innerHTML = ''; } if (importedData.skills && importedData.skills.length > 0) { document.getElementById('import-skills-count').textContent = importedData.skills.length; let skillsHTML = ''; importedData.skills.forEach(skill => { const checkinCount = skill.checkins ? skill.checkins.length : 0; skillsHTML += ` <label style="display: flex; align-items: center; justify-content: space-between; margin: 2px 0;"> <span>${skill.name} (${checkinCount}次打卡)</span> <input type="checkbox" data-skill-id="${skill.id}" checked> </label> `; }); document.getElementById('import-skills-details').innerHTML = skillsHTML; } else { document.getElementById('import-skills-count').textContent = '0'; document.getElementById('import-skills-details').innerHTML = ''; } if (importedData.reflections && importedData.reflections.length > 0) { document.getElementById('import-reflections-count').textContent = importedData.reflections.length; const { grouped: reflectionsByDate } = groupItemsByDate(importedData.reflections); let reflectionsHTML = ''; Object.keys(reflectionsByDate).sort((a, b) => new Date(b) - new Date(a)).forEach(date => { reflectionsHTML += ` <label style="display: flex; align-items: center; justify-content: space-between; margin: 2px 0;"> <span>${date} (${reflectionsByDate[date].length}条)</span> <input type="checkbox" data-date="${date}" checked> </label> `; }); document.getElementById('import-reflections-details').innerHTML = reflectionsHTML; } else { document.getElementById('import-reflections-count').textContent = '0'; document.getElementById('import-reflections-details').innerHTML = ''; } if (importedData.valueOutputs && importedData.valueOutputs.length > 0) { document.getElementById('import-value-count').textContent = importedData.valueOutputs.length; const valueByCategory = {}; importedData.valueOutputs.forEach(output => { if (!valueByCategory[output.category]) { valueByCategory[output.category] = []; } valueByCategory[output.category].push(output); }); let valueHTML = ''; Object.keys(valueByCategory).forEach(category => { valueHTML += ` <label style="display: flex; align-items: center; justify-content: space-between; margin: 2px 0;"> <span>${category} (${valueByCategory[category].length}条)</span> <input type="checkbox" data-category="${category}" checked> </label> `; }); document.getElementById('import-value-details').innerHTML = valueHTML; } else { document.getElementById('import-value-count').textContent = '0'; document.getElementById('import-value-details').innerHTML = ''; } setTimeout(() => { document.querySelectorAll('#import-preview input[type="checkbox"]').forEach(checkbox => { checkbox.addEventListener('change', () => { updateImportPreview(importedData); updateAllCheckboxState(); }); }); updateAllCheckboxState(); }, 100); } function updateAllCheckboxState() { const achievementCheckboxes = document.querySelectorAll('#import-achievements-details input[type="checkbox"]'); const allAchievementsChecked = achievementCheckboxes.length > 0 && Array.from(achievementCheckboxes).every(cb => cb.checked); document.getElementById('import-all-achievements').checked = allAchievementsChecked; const skillCheckboxes = document.querySelectorAll('#import-skills-details input[type="checkbox"]'); const allSkillsChecked = skillCheckboxes.length > 0 && Array.from(skillCheckboxes).every(cb => cb.checked); document.getElementById('import-all-skills').checked = allSkillsChecked; const reflectionCheckboxes = document.querySelectorAll('#import-reflections-details input[type="checkbox"]'); const allReflectionsChecked = reflectionCheckboxes.length > 0 && Array.from(reflectionCheckboxes).every(cb => cb.checked); document.getElementById('import-all-reflections').checked = allReflectionsChecked; const valueCheckboxes = document.querySelectorAll('#import-value-details input[type="checkbox"]'); const allValueChecked = valueCheckboxes.length > 0 && Array.from(valueCheckboxes).every(cb => cb.checked); document.getElementById('import-all-value').checked = allValueChecked; } function importMultipleData() { const importedData = window.selectedImportData; if (!importedData) { alert('请先选择要导入的数据'); return; } const totalCount = importedData.achievements.length + importedData.skills.length + importedData.reflections.length + importedData.valueOutputs.length; if (totalCount === 0) { alert('请至少选择一个分类进行导入'); return; } const success = mergeImportedData(importedData, '选择的文件'); if (success) { closeModal('enhanced-import-modal'); } } function processFilesSequentially(files, index, importResults) { if (index >= files.length) { showImportResults(importResults); return; } const file = files[index]; const reader = new FileReader(); reader.onload = function(e) { try { const importedData = JSON.parse(e.target.result); if (isValidDataFormat(importedData)) { const success = mergeImportedData(importedData, file.name); if (success) { importResults.success++; importResults.details.push({ filename: file.name, status: '成功', message: `导入 ${getDataSummary(importedData)}` }); } else { importResults.failed++; importResults.details.push({ filename: file.name, status: '取消', message: '用户取消了导入' }); } } else { throw new Error('文件格式不正确'); } } catch (error) { importResults.failed++; importResults.details.push({ filename: file.name, status: '失败', message: error.message }); } updateImportProgress(index + 1, files.length); processFilesSequentially(files, index + 1, importResults); }; reader.onerror = function() { importResults.failed++; importResults.details.push({ filename: file.name, status: '失败', message: '文件读取失败' }); updateImportProgress(index + 1, files.length); processFilesSequentially(files, index + 1, importResults); }; reader.readAsText(file); } function isValidDataFormat(data) { if (typeof data !== 'object') return false; try { if (!data.achievements || !Array.isArray(data.achievements)) return false; if (!data.skills || !Array.isArray(data.skills)) return false; if (!data.reflections || !Array.isArray(data.reflections)) return false; if (!data.valueOutputs || !Array.isArray(data.valueOutputs)) return false; if (data.achievements.length > 0) { const firstAchievement = data.achievements[0]; if (!firstAchievement.text || !firstAchievement.date) return false; } return true; } catch (e) { return false; } } function getDataSummary(data) { const parts = []; if (data.achievements) parts.push(`${data.achievements.length} 条成就`); if (data.skills) parts.push(`${data.skills.length} 项技能`); if (data.reflections) parts.push(`${data.reflections.length} 条反思`); if (data.valueOutputs) parts.push(`${data.valueOutputs.length} 条价值输出`); return parts.join(', '); } function updateImportProgress(current, total) { const progressPercent = (current / total) * 100; document.getElementById('import-progress-bar').style.width = `${progressPercent}%`; document.getElementById('import-progress-text').textContent = `处理中... ${current}/${total}`; } function showImportResults(results) { const resultsContainer = document.getElementById('import-results'); resultsContainer.innerHTML = ''; results.details.forEach(detail => { const resultItem = document.createElement('div'); resultItem.className = 'import-result-item'; resultItem.innerHTML = ` <div class="${detail.status === '成功' ? 'import-success' : 'import-failure'}"> <strong>${detail.filename}</strong> - ${detail.status}: ${detail.message} </div> `; resultsContainer.appendChild(resultItem); }); const summary = document.createElement('div'); summary.className = 'import-result-item'; summary.innerHTML = `<strong>汇总: 成功 ${results.success}/${results.total}, 失败 ${results.failed}/${results.total}</strong>`; resultsContainer.appendChild(summary); renderAchievements(); renderSkills(); renderReflections(); renderValueOutputs(); updateStats(); if (results.failed === 0) { closeModal('enhanced-import-modal'); } } function validateAndFixImportedData(importedData) { if (Array.isArray(importedData.achievements)) { importedData.achievements.forEach(achievement => { if (!achievement.timestamp || achievement.timestamp instanceof Date) { achievement.timestamp = fixMissingTimestamp(achievement.date, achievement.time); } if (typeof achievement.timestamp !== 'number') { achievement.timestamp = parseInt(achievement.timestamp) || new Date().getTime(); } }); } if (Array.isArray(importedData.reflections)) { importedData.reflections.forEach(reflection => { if (!reflection.timestamp || reflection.timestamp instanceof Date) { reflection.timestamp = fixMissingTimestamp(reflection.date, reflection.time); } if (typeof reflection.timestamp !== 'number') { reflection.timestamp = parseInt(reflection.timestamp) || new Date().getTime(); } }); } if (Array.isArray(importedData.valueOutputs)) { importedData.valueOutputs.forEach(valueOutput => { if (!valueOutput.timestamp || valueOutput.timestamp instanceof Date) { valueOutput.timestamp = fixMissingTimestamp(valueOutput.date, valueOutput.time); } if (typeof valueOutput.timestamp !== 'number') { valueOutput.timestamp = parseInt(valueOutput.timestamp) || new Date().getTime(); } }); } if (Array.isArray(importedData.skills)) { importedData.skills.forEach(skill => { if (Array.isArray(skill.checkins)) { skill.checkins.forEach(checkin => { if (!checkin.timestamp || checkin.timestamp instanceof Date) { checkin.timestamp = fixMissingTimestamp(checkin.date, checkin.time); } if (typeof checkin.timestamp !== 'number') { checkin.timestamp = parseInt(checkin.timestamp) || new Date().getTime(); } }); } }); } } function mergeImportedData(importedData, filename = '导入文件') { validateAndFixImportedData(importedData); const importStats = { achievements: Array.isArray(importedData.achievements) ? importedData.achievements.length : 0, skills: Array.isArray(importedData.skills) ? importedData.skills.length : 0, reflections: Array.isArray(importedData.reflections) ? importedData.reflections.length : 0, valueOutputs: Array.isArray(importedData.valueOutputs) ? importedData.valueOutputs.length : 0, recordDays: importedData.recordData ? importedData.recordData.recordDays : 0 }; if (Array.isArray(importedData.achievements)) { const existingAchievementIds = new Set(appData.achievements.map(a => a.id)); let addedAchievements = 0; importedData.achievements.forEach(achievement => { if (!existingAchievementIds.has(achievement.id)) { appData.achievements.push(achievement); addedAchievements++; } }); console.log(`导入了 ${addedAchievements} 条新成就记录`); } if (Array.isArray(importedData.skills)) { const existingSkillIds = new Set(appData.skills.map(s => s.id)); let addedSkills = 0; let addedCheckins = 0; importedData.skills.forEach(skill => { if (!existingSkillIds.has(skill.id)) { appData.skills.push(skill); addedSkills++; } else { const existingSkill = appData.skills.find(s => s.id === skill.id); const existingCheckinIds = new Set(existingSkill.checkins.map(c => c.id)); skill.checkins.forEach(checkin => { if (!existingCheckinIds.has(checkin.id)) { existingSkill.checkins.push(checkin); addedCheckins++; } }); } }); console.log(`导入了 ${addedSkills} 项新技能，${addedCheckins} 条打卡记录`); } if (Array.isArray(importedData.reflections)) { const existingReflectionIds = new Set(appData.reflections.map(r => r.id)); let addedReflections = 0; importedData.reflections.forEach(reflection => { if (!existingReflectionIds.has(reflection.id)) { appData.reflections.push(reflection); addedReflections++; } }); console.log(`导入了 ${addedReflections} 条新反思记录`); } if (Array.isArray(importedData.valueOutputs)) { const existingValueOutputIds = new Set(appData.valueOutputs.map(v => v.id)); let addedValueOutputs = 0; importedData.valueOutputs.forEach(valueOutput => { if (!existingValueOutputIds.has(valueOutput.id)) { appData.valueOutputs.push(valueOutput); addedValueOutputs++; } }); console.log(`导入了 ${addedValueOutputs} 条新价值输出记录`); } if (importedData.recordData && Array.isArray(importedData.recordData.recordDates)) { const importedRecordDates = new Set(importedData.recordData.recordDates); appData.recordData.recordDates.forEach(date => importedRecordDates.add(date)); appData.recordData.recordDates = Array.from(importedRecordDates); appData.recordData.recordDays = appData.recordData.recordDates.length; } appData.achievements.sort((a, b) => { const timeA = a.timestamp || new Date(a.date + ' ' + a.time).getTime(); const timeB = b.timestamp || new Date(b.date + ' ' + b.time).getTime(); return timeB - timeA; }); appData.reflections.sort((a, b) => { const timeA = a.timestamp || new Date(a.date).getTime(); const timeB = b.timestamp || new Date(b.date).getTime(); return timeB - timeA; }); appData.valueOutputs.sort((a, b) => { const timeA = a.timestamp || new Date(a.date).getTime(); const timeB = b.timestamp || new Date(b.date).getTime(); return timeB - timeA; }); appData.skills.forEach(skill => { skill.checkins.sort((a, b) => { const timeA = a.timestamp || new Date(a.date).getTime(); const timeB = b.timestamp || new Date(b.date).getTime(); return timeB - timeA; }); }); checkRecordDays(); saveData(); renderAchievements(); renderSkills(); renderReflections(); renderValueOutputs(); updateStats(); updateSearchStatus(); return true; } function resetData() { document.getElementById('reset-password').value = ''; document.getElementById('password-error').style.display = 'none'; document.getElementById('reset-modal').style.display = 'flex'; const dateRange = getDateRange(); document.getElementById('reset-start-date').value = dateRange.earliest; document.getElementById('reset-end-date').value = dateRange.latest; document.getElementById('reset-all-dates').checked = true; document.querySelectorAll('.reset-category-checkbox').forEach(checkbox => { checkbox.checked = true; }); updateResetSummary(); document.querySelectorAll('.reset-category-checkbox').forEach(checkbox => { checkbox.addEventListener('change', updateResetSummary); }); document.getElementById('reset-start-date').addEventListener('change', updateResetSummary); document.getElementById('reset-end-date').addEventListener('change', updateResetSummary); document.getElementById('reset-all-dates').addEventListener('change', function() { const dateInputs = document.querySelectorAll('#reset-start-date, #reset-end-date'); dateInputs.forEach(input => input.disabled = this.checked); updateResetSummary(); }); document.querySelectorAll('#reset-start-date, #reset-end-date').forEach(input => { input.disabled = true; }); } function updateResetSummary() { const resetAchievements = document.getElementById('reset-achievements').checked; const resetSkills = document.getElementById('reset-skills').checked; const resetReflections = document.getElementById('reset-reflections').checked; const resetValue = document.getElementById('reset-value').checked; const resetAllDates = document.getElementById('reset-all-dates').checked; let startDate, endDate; if (!resetAllDates) { startDate = document.getElementById('reset-start-date').value; endDate = document.getElementById('reset-end-date').value; } let totalCount = 0; const details = []; if (resetAchievements) { const achievements = getRecordsToDelete(appData.achievements, startDate, endDate, resetAllDates); totalCount += achievements.length; if (achievements.length > 0) { details.push(`每日成就: ${achievements.length} 条`); } } if (resetSkills) { let skillCount = 0; let checkinCount = 0; appData.skills.forEach(skill => { const checkins = getRecordsToDelete(skill.checkins, startDate, endDate, resetAllDates); if (checkins.length > 0) { skillCount++; checkinCount += checkins.length; } }); totalCount += checkinCount; if (skillCount > 0) { details.push(`技能成长: ${skillCount} 项技能，${checkinCount} 次打卡`); } } if (resetReflections) { const reflections = getRecordsToDelete(appData.reflections, startDate, endDate, resetAllDates); totalCount += reflections.length; if (reflections.length > 0) { details.push(`自我对话: ${reflections.length} 条`); } } if (resetValue) { const valueOutputs = getRecordsToDelete(appData.valueOutputs, startDate, endDate, resetAllDates); totalCount += valueOutputs.length; if (valueOutputs.length > 0) { details.push(`创造价值: ${valueOutputs.length} 条`); } } const estimatedSize = (totalCount * 0.5).toFixed(2); const detailsHTML = details.length > 0 ? details.map(detail => `<p>• ${detail}</p>`).join('') : '<p>请选择要重置的分类...</p>'; document.getElementById('reset-details').innerHTML = detailsHTML; document.getElementById('reset-total-count').textContent = totalCount; document.getElementById('reset-total-size').textContent = estimatedSize; document.getElementById('confirm-reset-btn').disabled = totalCount === 0; } function getRecordsToDelete(records, startDate, endDate, allDates) { if (!records || records.length === 0) return []; if (allDates) { return records; } if (!startDate || !endDate) { return []; } const start = new Date(startDate); const end = new Date(endDate); end.setHours(23, 59, 59, 999); return filterByDateRange(records, startDate, endDate); } function confirmResetData() { const password = document.getElementById('reset-password').value;
         
		 
		 const correctPassword = '11111';
		 
		 
         
  if (password !== correctPassword) { document.getElementById('password-error').style.display = 'block'; document.getElementById('reset-password').value = ''; document.getElementById('reset-password').focus(); return; } const resetAchievements = document.getElementById('reset-achievements').checked; const resetSkills = document.getElementById('reset-skills').checked; const resetReflections = document.getElementById('reset-reflections').checked; const resetValue = document.getElementById('reset-value').checked; const resetAllDates = document.getElementById('reset-all-dates').checked; let startDate, endDate; if (!resetAllDates) { startDate = document.getElementById('reset-start-date').value; endDate = document.getElementById('reset-end-date').value; } let resetCount = 0; if (resetAchievements) { if (resetAllDates) { resetCount += appData.achievements.length; appData.achievements = []; } else { const remaining = appData.achievements.filter(record => { const recordDate = new Date(record.date); const start = new Date(startDate); const end = new Date(endDate); end.setHours(23, 59, 59, 999); return recordDate < start || recordDate > end; }); resetCount += (appData.achievements.length - remaining.length); appData.achievements = remaining; } } if (resetSkills) { appData.skills.forEach(skill => { if (resetAllDates) { resetCount += skill.checkins.length; skill.checkins = []; } else { const remainingCheckins = skill.checkins.filter(checkin => { const checkinDate = new Date(checkin.date); const start = new Date(startDate); const end = new Date(endDate); end.setHours(23, 59, 59, 999); return checkinDate < start || checkinDate > end; }); resetCount += (skill.checkins.length - remainingCheckins.length); skill.checkins = remainingCheckins; } }); appData.skills = appData.skills.filter(skill => skill.checkins.length > 0); } if (resetReflections) { if (resetAllDates) { resetCount += appData.reflections.length; appData.reflections = []; } else { const remaining = appData.reflections.filter(record => { const recordDate = new Date(record.date); const start = new Date(startDate); const end = new Date(endDate); end.setHours(23, 59, 59, 999); return recordDate < start || recordDate > end; }); resetCount += (appData.reflections.length - remaining.length); appData.reflections = remaining; } } if (resetValue) { if (resetAllDates) { resetCount += appData.valueOutputs.length; appData.valueOutputs = []; } else { const remaining = appData.valueOutputs.filter(record => { const recordDate = new Date(record.date); const start = new Date(startDate); const end = new Date(endDate); end.setHours(23, 59, 59, 999); return recordDate < start || recordDate > end; }); resetCount += (appData.valueOutputs.length - remaining.length); appData.valueOutputs = remaining; } } checkRecordDays(); saveData(); clearSearch(); renderAchievements(); renderSkills(); renderReflections(); renderValueOutputs(); updateStats(); if (appData.achievements.length === 0) { document.getElementById('achievements-list').innerHTML = ''; } if (appData.skills.length === 0) { document.getElementById('skills-list').innerHTML = ''; } if (appData.reflections.length === 0) { document.getElementById('reflection-list').innerHTML = ''; } if (appData.valueOutputs.length === 0) { document.getElementById('value-outputs-list').innerHTML = ''; } closeModal('reset-modal'); } function performSearch() { const searchInput = document.getElementById('search-input'); searchKeyword = searchInput.value.trim(); renderAchievements(); renderSkills(); renderReflections(); renderValueOutputs(); updateSearchStatus(); } function showDateFilterModal() { document.getElementById('date-filter-modal').style.display = 'flex'; renderCalendar(); } document.addEventListener('DOMContentLoaded', function() { const dateFilterTabs = document.querySelectorAll('.date-filter-tab'); const dateFilterContents = document.querySelectorAll('.date-filter-content'); dateFilterTabs.forEach(tab => { tab.addEventListener('click', function() { dateFilterTabs.forEach(t => t.classList.remove('active')); this.classList.add('active'); dateFilterContents.forEach(content => content.classList.remove('active')); const filterType = this.getAttribute('data-filter-type'); document.getElementById(`date-filter-${filterType}`).classList.add('active'); if (filterType === 'day') { renderCalendar(); } }); }); const skillCategoryButtons = document.querySelectorAll('.skill-category-button'); skillCategoryButtons.forEach(button => { button.addEventListener('click', function() { skillCategoryButtons.forEach(btn => btn.classList.remove('active')); this.classList.add('active'); skillCategoryFilter = this.getAttribute('data-category'); renderSkills(); }); }); }); function renderCalendar() { const container = document.getElementById('calendar-container'); container.innerHTML = ''; const recordDates = getAllRecordDates(); const months = {}; recordDates.forEach(dateStr => { const date = new Date(dateStr); const year = date.getFullYear(); const month = date.getMonth(); const key = `${year}-${month}`; if (!months[key]) { months[key] = { year: year, month: month, dates: [] }; } months[key].dates.push(date.getDate()); }); Object.values(months).forEach(monthData => { const monthDiv = document.createElement('div'); monthDiv.className = 'calendar-month'; const monthHeader = document.createElement('div'); monthHeader.className = 'calendar-month-header'; monthHeader.textContent = `${monthData.year}年${monthData.month + 1}月`; monthDiv.appendChild(monthHeader); const weekdaysDiv = document.createElement('div'); weekdaysDiv.className = 'calendar-weekdays'; ['日', '一', '二', '三', '四', '五', '六'].forEach(day => { const dayDiv = document.createElement('div'); dayDiv.textContent = day; weekdaysDiv.appendChild(dayDiv); }); monthDiv.appendChild(weekdaysDiv); const daysDiv = document.createElement('div'); daysDiv.className = 'calendar-days'; const firstDay = new Date(monthData.year, monthData.month, 1).getDay(); for (let i = 0; i < firstDay; i++) { const emptyDay = document.createElement('div'); emptyDay.className = 'calendar-day empty'; daysDiv.appendChild(emptyDay); } const daysInMonth = new Date(monthData.year, monthData.month + 1, 0).getDate(); for (let day = 1; day <= daysInMonth; day++) { const dayDiv = document.createElement('div'); dayDiv.className = 'calendar-day'; dayDiv.textContent = day; if (monthData.dates.includes(day)) { dayDiv.classList.add('recorded'); } dayDiv.addEventListener('click', function() { const selectedDate = new Date(monthData.year, monthData.month, day); dateFilter = selectedDate.toLocaleDateString(); renderAchievements(); renderSkills(); renderReflections(); renderValueOutputs(); closeModal('date-filter-modal'); }); daysDiv.appendChild(dayDiv); } monthDiv.appendChild(daysDiv); container.appendChild(monthDiv); }); }function applyDateFilter(type) { let dateFilterValue; switch(type) { case 'day': const dateInput = document.getElementById('date-filter-input'); const selectedDate = dateInput.value; if (!selectedDate) { alert('请选择日期'); return; } const filterDate = new Date(selectedDate); dateFilterValue = filterDate.toLocaleDateString(); break; case 'month': const monthInput = document.getElementById('month-filter-input'); const selectedMonth = monthInput.value; if (!selectedMonth) { alert('请选择月份'); return; } dateFilterValue = { type: 'month', value: selectedMonth }; break; case 'year': const yearInput = document.getElementById('year-filter-input'); const selectedYear = yearInput.value; if (!selectedYear) { alert('请选择年份'); return; } dateFilterValue = { type: 'year', value: selectedYear }; break; case 'range': const startDateInput = document.getElementById('start-date-input'); const endDateInput = document.getElementById('end-date-input'); const startDate = startDateInput.value; const endDate = endDateInput.value; if (!startDate || !endDate) { alert('请选择开始日期和结束日期'); return; } if (new Date(startDate) > new Date(endDate)) { alert('开始日期不能晚于结束日期'); return; } dateFilterValue = { type: 'range', start: startDate, end: endDate }; break; default: return; } dateFilter = dateFilterValue; renderAchievements(); renderSkills(); renderReflections(); renderValueOutputs(); closeModal('date-filter-modal'); updateSearchStatus();} function clearDateFilter() { dateFilter = ''; renderAchievements(); renderSkills(); renderReflections(); renderValueOutputs(); closeModal('date-filter-modal'); updateSearchStatus(); } function showReminderModal() { const settings = appData.reminderSettings; document.getElementById('enable-reminder').checked = settings.enabled; if (settings.type === 'weekly') { document.querySelector('input[name="reminder-type"][value="weekly"]').checked = true; document.getElementById('reminder-weekday').value = settings.day; } else { document.querySelector('input[name="reminder-type"][value="monthly"]').checked = true; document.getElementById('reminder-day').value = settings.day; } const daySelect = document.getElementById('reminder-day'); daySelect.innerHTML = ''; for (let i = 1; i <= 31; i++) { const option = document.createElement('option'); option.value = i; option.textContent = i + '号'; daySelect.appendChild(option); } toggleReminderDetails(); toggleReminderType(); document.getElementById('reminder-modal').style.display = 'flex'; } function toggleReminderDetails() { const enableReminder = document.getElementById('enable-reminder').checked; document.getElementById('reminder-details').style.display = enableReminder ? 'block' : 'none'; } function toggleReminderType() { const reminderType = document.querySelector('input[name="reminder-type"]:checked').value; document.getElementById('weekly-reminder').style.display = reminderType === 'weekly' ? 'block' : 'none'; document.getElementById('monthly-reminder').style.display = reminderType === 'monthly' ? 'block' : 'none'; } function saveReminderSettings() { const enabled = document.getElementById('enable-reminder').checked; const type = document.querySelector('input[name="reminder-type"]:checked').value; let day; if (type === 'weekly') { day = parseInt(document.getElementById('reminder-weekday').value); } else { day = parseInt(document.getElementById('reminder-day').value); } appData.reminderSettings = { enabled: enabled, type: type, day: day, lastReminded: appData.reminderSettings.lastReminded }; saveData(); closeModal('reminder-modal'); if (enabled) { alert('提醒设置已保存！'); } else { alert('提醒已关闭'); } } document.addEventListener('DOMContentLoaded', function() { const valueButtons = document.querySelectorAll('.value-category-button'); const valueInputAreas = document.querySelectorAll('.value-input-area'); valueButtons.forEach(button => { button.addEventListener('click', function() { valueButtons.forEach(btn => btn.classList.remove('active')); this.classList.add('active'); valueInputAreas.forEach(area => area.classList.remove('active')); const category = this.getAttribute('data-category'); document.getElementById(`value-input-${category}`).classList.add('active'); }); }); }); function checkFirstUse() { if (!localStorage.getItem('privacyAccepted')) { document.getElementById('privacy-modal').style.display = 'flex'; }}function acceptPrivacy() { localStorage.setItem('privacyAccepted', 'true'); document.getElementById('privacy-modal').style.display = 'none';} window.onload = function() { checkFirstUse(); loadData();const header = document.getElementById('main-header');if (!header.classList.contains('reminder')) { const slogans = [ '记录成长，发现更好的自己', '专注进步，而非完美' ]; const randomIndex = Math.floor(Math.random() * slogans.length); document.getElementById('random-slogan').textContent = slogans[randomIndex];} const dateFilterTabs = document.querySelectorAll('.date-filter-tab'); const dateFilterContents = document.querySelectorAll('.date-filter-content'); dateFilterTabs.forEach(tab => { tab.addEventListener('click', function() { dateFilterTabs.forEach(t => t.classList.remove('active')); this.classList.add('active'); dateFilterContents.forEach(content => content.classList.remove('active')); const filterType = this.getAttribute('data-filter-type'); document.getElementById(`date-filter-${filterType}`).classList.add('active'); if (filterType === 'day') { renderCalendar(); } }); }); const skillCategoryButtons = document.querySelectorAll('.skill-category-button'); skillCategoryButtons.forEach(button => { button.addEventListener('click', function() { skillCategoryButtons.forEach(btn => btn.classList.remove('active')); this.classList.add('active'); skillCategoryFilter = this.getAttribute('data-category'); renderSkills(); }); }); const valueButtons = document.querySelectorAll('.value-category-button'); const valueInputAreas = document.querySelectorAll('.value-input-area'); valueButtons.forEach(button => { button.addEventListener('click', function() { valueButtons.forEach(btn => btn.classList.remove('active')); this.classList.add('active'); valueInputAreas.forEach(area => area.classList.remove('active')); const category = this.getAttribute('data-category'); document.getElementById(`value-input-${category}`).classList.add('active'); }); }); };
        // =============================================
        // 正反馈成长助手
        // 作者：励小加 © 2025
        // 许可证：GPLv3 - https://www.gnu.org/licenses/gpl-3.0.html
        // 源代码：https://github.com/li-xiao-jia/positive-feedback-assistant  
        // 支持作者：https://space.bilibili.com/557858654
        // =============================================
    </script>
   </body>
</html>
